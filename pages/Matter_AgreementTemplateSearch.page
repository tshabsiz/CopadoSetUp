<!--
 _____ _                 _ _____           _ _   _         
/  __ \ |               | /  ___|         (_) | | |        
| /  \/ | ___  _   _  __| \ `--. _ __ ___  _| |_| |__  ___ 
| |   | |/ _ \| | | |/ _` |`--. \ '_ ` _ \| | __| '_ \/ __|
| \__/\ | (_) | |_| | (_| /\__/ / | | | | | | |_| | | \__ \
 \____/_|\___/ \__,_|\__,_\____/|_| |_| |_|_|\__|_| |_|___/
 
 *** CHANGE LOG ***
 
 20/06/2017 - PG    - Added Condition Monitored By to deal parties view.
 28/08/2017 - PG    - Changes the page message not escape messages.
                                                           
-->
<apex:page controller="AgreementSearchOnMatter" tabStyle="advpm__Matter__c" action="{!LoadAgreements}">

    <script>
        window.addEventListener("keyup", checkKeyPressed, false);
 
        function checkKeyPressed(e) {
            if (e.keyCode == "8" || e.keyCode == "46") {
                clearFunction();
            }
            else{
                DoSearch();
            }
        }
    </script>
    
    <!-- CUSTOM CSS -->
    <style type="text/css">
    .pageDescription {
        white-space: nowrap
    }
    </style>
    <!-- / CUSTOM CSS -->
    
    <!-- PAGE HEADER -->
    <apex:sectionHeader title="Deal Agreements" subtitle="Search for Agreement templates to add to {!matter.Name}" />
    
    <!-- FORM -->
    <apex:form >
    <apex:actionFunction name="DoSearch" action="{!Searchagreement}" reRender="Results1,Results2"  />
    <apex:actionFunction name="clearFunction" action="{!clearData}" reRender="Results1,Results2"  />

        <!-- PAGE ERRORS -->
        <apex:pageMessages escape="false" />
        
        <!-- PAGE BLOCK-->
        <apex:pageBlock title="Agreement Templates"  mode="detail" >
            
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Add Agreements and Save" action="{!GenerateSearchAgreements}"/>
                <apex:commandButton value="Add Knowledge to Matter" action="{!AddMattertoCase}"/>
                <apex:commandButton value="Close" action="{!actionCancel}"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection title="Search Agreement Templates" columns="1" collapsible="false">
                <apex:outputLabel >Search:</apex:outputLabel>
                <apex:inputText value="{!AgreementSearch}" /> <!--onkeyup="DoSearch();"-->
            </apex:pageBlockSection>
            
            <!-- PAGE BLOCK SECTION - AGREEMENTS -->
            <apex:pageBlockSection title="Existing Agreements on Matter" columns="1" collapsible="false" >
                
                <!-- PAGE TABLE -->
                <apex:pageBlockTable value="{!lst_Agreement}" var="wrapperItem">
                    <apex:column value="{!wrapperItem.Name}">
                        <apex:facet name="header">Name</apex:facet>
                       
                    </apex:column>
                    <apex:column value="{!wrapperItem.Product__c}" >
                        <apex:facet name="header">Product</apex:facet>
                   
                    </apex:column>
                    <apex:column value="{!wrapperItem.Agreement_Type__c}">
                        <apex:facet name="header">Agreement Type</apex:facet>
                    </apex:column>
                    <apex:column value="{!wrapperItem.Agreement_Template__c}">
                        <apex:facet name="header">Template</apex:facet>
                    </apex:column>
                </apex:pageBlockTable>
                <!-- / PAGE TABLE -->
            
            </apex:pageBlockSection>
            <!-- / PAGE BLOCK SECTION -->
            
            <!-- PAGE BLOCK SECTION - DEAL PARTIES -->
           
            
            
            <apex:pageBlockSection title="Select Agreement Templates" columns="1" collapsible="false" id="Results1">
                
                <!-- PAGE TABLE -->
                <apex:pageBlockTable value="{!productAgreementsWrapperSearch}" var="wrapperItem">
                  
                    <apex:column >
                        <apex:facet name="header">Select</apex:facet>
                        <apex:inputCheckbox value="{!wrapperItem.selected}" />
                    </apex:column>
                   <apex:column value="{!wrapperItem.record.Name}">
                        <apex:facet name="header">Agreement Name</apex:facet>
                    </apex:column>
                    <apex:column value="{!wrapperItem.record.Description__c}">
                        <apex:facet name="header">Description</apex:facet>
                    </apex:column>
                </apex:pageBlockTable>
                <!-- / PAGE TABLE -->
            
            </apex:pageBlockSection>
            <!-- / PAGE BLOCK SECTION -->
            
            <apex:pageBlockSection title="Select Knowledge Case" columns="1" collapsible="false" id="Results2">
                
                <!-- PAGE TABLE -->
                <apex:pageBlockTable value="{!lst_Casesearch}" var="case">
                  
                    <apex:column >
                        <apex:facet name="header">Select</apex:facet>
                        <apex:inputCheckbox value="{!case.CasSelected}" />
                    </apex:column>
                   <apex:column value="{!case.CasSubject}">
                        <apex:facet name="header">Subject</apex:facet>
                    </apex:column>
                    <apex:column value="{!case.CasDescription}">
                        <apex:facet name="header">Description</apex:facet>
                    </apex:column>
                    
                     <apex:column value="{!case.CasSuggestedTags}">
                        <apex:facet name="header">Suggested Tags</apex:facet>
                    </apex:column>
                    
                     <apex:column value="{!case.CasSuggestedLibrary}">
                        <apex:facet name="header">Suggested Library</apex:facet>
                    </apex:column>
                    <apex:column value="{!case.CasMatter}">
                        <apex:facet name="header">Matter</apex:facet>
                    </apex:column>
                </apex:pageBlockTable>
                <!-- / PAGE TABLE -->
            
            </apex:pageBlockSection>
            
        
        </apex:pageBlock>
        <!-- / PAGE BLOCK-->
    
    </apex:form>
    <!-- / FORM -->

</apex:page>