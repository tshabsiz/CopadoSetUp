<apex:page standardController="Annual_Pricing__c" extensions="APT_PricingLetterController" applyHtmlTag="false" applyBodyTag="false" showHeader="false" sidebar="false" renderAs="pdf">
<head>
    <style type="text/css" media="print">

        body {
            font-family: Arial Unicode MS;
            font-size: 10pt;
        }

        @page {
            size: portrait;
            margin-bottom: 150px;
            @bottom-left {
                content: element(footer);
            }
        	@bottom-right {
        		font-size: 6pt;
        		font-family: Arial Unicode MS;
              	content: "Page " counter(page)  " of " counter(pages);
 			}
        }
        
        @page :first {
        	margin-top: 300px;
        	@top-center {
                content: element(header);
            }
            @bottom-right {
        		/* Nothing for first page */
            }
		}

        div.header {
            padding-top: 50px;
            position: running(header);
        }
        div.footer {
            display: block;
            position: running(footer);
        }

        div.content {
            display: block;
            margin-left: 30px;
            margin-right: 30px;
        }
        div.page-break-after {
            page-break-after: always;
        }

        div.page-break-before {
            page-break-before: always;
        }

        p.header-text-red {
            margin-top: 0px;
            padding-left: 1px;
            font-family: Arial Unicode MS;
            font-size: 9pt;
            font-weight: bold;
            color: rgb(236,34,42);
        }
        p.header-text {
            padding-left: 1px;
            font-family: Arial Unicode MS;
            font-size: 8pt;
            color: rgb(127,127,127);
        }
        p.footer-text {
            margin-top: 0px;
            font-family: Arial Unicode MS;
            font-size: 6pt;
        }
        p.bold-text, span.bold-text {
            font-family: Arial Unicode MS;
            font-size: 9pt;
            font-weight: bold;
        }
        p.italic-text, span.italic-text {
            font-family: Arial Unicode MS;
            font-size: 9pt;
            font-style: italic;
        }

        p.main-text, span.main-text, li.main-text {
            font-family: sans-serif;
            font-size: 10pt;
        }
        p.main-text-bold, span.main-text-bold, li.main-text-bold {
            font-family: sans-serif;
            font-size: 10pt;
            font-weight: bold;
        }
        table {
            border-collapse: collapse;
        }
        .standard-cell {
            font-size: 8pt;
            border: 1px solid black;
        }
        .header-cell {
            font-size: 8pt;
            font-weight: bold;
            vertical-align: top;
            border: 1px solid black;
        }
    </style>
</head>
    <div class="header">
        <table width="100%">
            <tr>
                <td width="75%" valign="top"><apex:image value="{!$Resource.Pricing_Letter_Header_Left}" /></td>
                <td width="25%">
                    <apex:image value="{!$Resource.Pricing_Letter_Header_Right}" />
                    <p class="header-text-red"><apex:outputText value="{!$Label.lbl_Confidential}" /></p>
                    <p class="header-text"><apex:outputField value="{!pricingTemplate.Address__c}" /></p>
                    <p class="header-text"><apex:outputField value="{!pricingTemplate.Phone_Fax__c}" /></p>
                    <p class="header-text"><apex:outputField value="{!pricingTemplate.Website__c}" /></p>
                </td>
            </tr>
        </table>
    </div>
    <div class="footer">
        <p class="footer-text"><apex:outputField value="{!pricingTemplate.Legal_Info__c}" /></p>
    </div>

<div class="content">
    <div class="page-break-after">
        <p>{!currentDate}</p>
        <p>
            <apex:outputText value="{!$Label.lbl_Directors}" />
            <br/>
            <apex:outputText styleClass="bold-text" value="{!Annual_Pricing__c.Organisation__r.Name}" />
            <br/>
            <apex:outputText styleClass="text" value="{!Annual_Pricing__c.Billing_Street__c}" />
            <br/>
            <apex:outputText styleClass="text" value="{!Annual_Pricing__c.Billing_City__c}" />
            <br/>
            <apex:outputText styleClass="text" value="{!Annual_Pricing__c.Billing_Zip_Postal_Code__c}" />
        </p>
        <p class="italic-text"><apex:outputText value="{!$Label.lbl_WithoutPrejudice}" /></p>
        <p class="main-text"><apex:outputText value="{!$Label.lbl_StrictlyPrivateAndConfidential}" /></p>
        <p class="main-text"><apex:outputField value="{!Annual_Pricing__c.Greeting__c}" /></p>
        <p class="main-text-bold"><apex:outputField value="{!pricingTemplate.Title__c}" /></p>
        <p class="main-text">
            <apex:outputField value="{!pricingTemplate.Section_1__c}" />
        </p>
    </div>
    <div class="page-break-after">
        <p class="main-text">
            <apex:outputField value="{!pricingTemplate.Section_2__c}" />
        </p>
        <br/>
        <br/>
        <br/>
        <br/>
        <p class="main-text"><apex:outputText value="{!$Label.lbl_YoursSincerely}" /></p>
        <br/>
        <br/>
        <table width="100%">
            <tr>
                <td width="60%">________________________</td>
                <td>________________________</td>
            </tr>
            <tr>
                <td width="60%">
                    <span class="main-text"><apex:outputField value="{!pricingTemplate.On_Behalf__c}" /></span>
                </td>
                <td>
                    <span class="main-text"><apex:outputField value="{!pricingTemplate.On_Behalf__c}" /></span>
                </td>
            </tr>
            <tr>
                <td width="60%">
                    <span class="main-text-bold"><apex:outputField value="{!Annual_Pricing__c.Signer_1__r.Name}" /></span>
                </td>
                <td>
                    <span class="main-text-bold"><apex:outputField value="{!Annual_Pricing__c.Signer_2__r.Name}" /></span>
                </td>
            </tr>
            <tr>
                <td width="60%">
                    <span class="main-text-bold"><apex:outputField value="{!Annual_Pricing__c.The_Signer_Role_1__c}" /></span>
                </td>
                <td>
                    <span class="main-text-bold"><apex:outputField value="{!Annual_Pricing__c.The_Signer_Role_2__c}" /></span>
                </td>
            </tr>
        </table>
    </div>
    <div class="page-break-after">
        <p class="main-text-bold"><apex:outputField value="{!pricingTemplate.Title_for_Group_Entities__c}" /></p>
        <ul>
            <apex:repeat value="{!groupEntities}" var="groupEntity">
                <li class="main-text-bold">{!groupEntity.Name}</li>
            </apex:repeat>
        </ul>
        <p class="main-text"><apex:outputField value="{!pricingTemplate.Title_for_Pricing_Groups__c}" /></p>
        <ul>
            <apex:repeat value="{!pricingGroups}" var="pricingGroup">
                <li class="main-text-bold">{!pricingGroup.record.Name}</li>
            </apex:repeat>
        </ul>
        <p class="main-text"><apex:outputField value="{!pricingTemplate.Section_3__c}" /></p>
    </div>
    <apex:repeat value="{!pricingGroups}" var="pricingGroup">
        <div class="page-break-before">
            <table class="products">
                <apex:repeat value="{!pricingGroup.productCategories}" var="productCategory">
                    <apex:repeat value="{!productCategory.productTypes}" var="productType">
                        <apex:repeat value="{!productType.annualPricingItems}" var="annualPricingItem">
                        <apex:outputPanel layout="block" rendered="{!productCategory.isFirst && productType.isFirst && annualPricingItem.isFirst}">
                        <tr>
                            <td class="header-cell" width="15%" rowspan="{!pricingGroup.rowspan+1}">
                                <apex:outputText value="{!pricingGroup.record.Name}" />
                            </td>
                            <td class="header-cell" width="15%"></td>
                            <td class="header-cell" width="15%"></td>
                            <td class="header-cell" width="30%"></td>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_To_Previous_Year_Prices__c && Annual_Pricing__c.Show_Previous_Comparative__c}">
                            <td class="header-cell">
                                <apex:outputText value="{!Annual_Pricing__c.Previous_Year__c} {!IF(pricingGroup.record.VAT_Inclusive__c,'Incl. VAT','Excl. VAT')}" />
                            </td>
                            </apex:outputPanel>
                            <td class="header-cell">
                                <apex:outputText value="{!Annual_Pricing__c.Year__c} {!IF(pricingGroup.record.VAT_Inclusive__c,'Incl. VAT','Excl. VAT')}" />
                            </td>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_Excl_Incl_VAT_Prices__c}">
                            <td class="header-cell">
                                <apex:outputText value="VAT" />
                            </td>
                            </apex:outputPanel>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_Excl_Incl_VAT_Prices__c}">
                            <td class="header-cell">
                                <apex:outputText value="{!Annual_Pricing__c.Year__c} Incl. VAT" />
                            </td>
                            </apex:outputPanel>
                        </tr>
                        </apex:outputPanel>
                        <tr>
                            <apex:outputPanel layout="none" rendered="{!productType.isFirst && annualPricingItem.isFirst}">
                            <td class="header-cell" rowspan="{!productCategory.rowspan}">
                                <apex:outputText value="{!productCategory.Name}" />
                            </td>
                            </apex:outputPanel>
                            <apex:outputPanel layout="none" rendered="{!annualPricingItem.isFirst}">
                            <td class="header-cell" rowspan="{!productType.rowspan}">
                                <apex:outputText value="{!productType.Name}" />
                            </td>
                            </apex:outputPanel>
                            <td class="standard-cell">
                                <apex:outputText value="{!annualPricingItem.record.Pricing_Deal_Product_Name__c}" />
                            </td>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_To_Previous_Year_Prices__c && Annual_Pricing__c.Show_Previous_Comparative__c}">
                            <td class="standard-cell" style="text-align: {!IF(ISNUMBER(annualPricingItem.previousRecord.Final_Price__c), 'right', 'left')};">
                                <apex:outputText value="{!annualPricingItem.previousRecord.Final_Price__c}" />
                            </td>
                            </apex:outputPanel>
                            <td class="standard-cell" style="text-align: {!IF(ISNUMBER(annualPricingItem.record.Final_Price__c), 'right', 'left')};">
                                <apex:outputText value="{!annualPricingItem.record.Final_Price__c}" />
                            </td>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_Excl_Incl_VAT_Prices__c}">
                            <td class="standard-cell">
                                <apex:outputText value="{!annualPricingItem.record.VAT_Amount__c}" />
                            </td>
                            </apex:outputPanel>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_Excl_Incl_VAT_Prices__c}">
                            <td class="standard-cell">
                                <apex:outputText value="{!annualPricingItem.record.Final_Price_VAT_Incl__c}" />
                            </td>
                            </apex:outputPanel>
                            <apex:outputPanel layout="none" rendered="{!pricingGroup.record.Compare_To_Previous_Year_Prices__c && Annual_Pricing__c.Show_Previous_Comparative__c}">
                            <td></td>
                            </apex:outputPanel>
                            <apex:outputPanel layout="none" rendered="{!NOT(pricingGroup.record.Compare_To_Previous_Year_Prices__c && Annual_Pricing__c.Show_Previous_Comparative__c) && NOT(pricingGroup.record.Compare_Excl_Incl_VAT_Prices__c)}">
                            <td></td>
                            <td></td>
                            </apex:outputPanel>
                        </tr>
                        </apex:repeat>
                    </apex:repeat>
                </apex:repeat>
            </table>
        </div>
    </apex:repeat>
</div>

</apex:page>