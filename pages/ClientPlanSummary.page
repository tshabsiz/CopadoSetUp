<apex:page controller="ClientPlanSummaryController" standardStylesheets="false" sidebar="false">
    <apex:includeScript value="{!URLFOR($Resource.jsPDF,    'jspdf.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jsPDF,    'html2canvas.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jsPDF,    'jspdf.plugin.autotable.js')}"/>    
    <apex:includeScript value="../../soap/ajax/31.0/connection.js" />

    <apex:outputPanel id="mainContentPanel">
        <script>
            var planLoaded = {!planLoaded};
            var titlePageGenerated,
                overviewGenerated,
                financialsGenerated,
                presenceGenerated,
                stakeholdersGenerated,
                strategyGenerated,
                planGenerated,
                pdfOutput,
                somethingAlreadyRendered = false;
                
            var margins = {
                top: 40,
                bottom: 60,
                left: 40,
                width: 730
            };

            var pdfPage = 1;
            
            var attachmentBaseUrl = '/servlet/servlet.FileDownload?file=';
            
            //organogram variables
            var itemTemplate = 'itemTemplate';
            
            //stakeholders hierarchy variables
            var contactTemplate = 'contactTemplate';
        
            $('document').ready(function() {
                selectLabel(8);

                if(planLoaded) {
                    prepareTextareas();
                    replaceNewLines();
                    prepareGenerateButtonOnClick();
                    //preparePrintButtonOnClick();
                    
                    if ('{!plan.Org_Structure_Image_ID__c}' == '') {
                        $('#organogram').show();
                        //Create createOrganogram chains through to createMap when it's finished
                        createOrganogram();
                    } else {
                        //We'll go straight to createMap
                        createMap();
                    }
                    
                    prepareAbsaSecurityRichtexts();
                    trimFields();
                }
            });
            
            //******************* start of organogram functions ******************************************
            function createOrganogram() {
                startLoading('{!$Label.lbl_Loading}');
                
                var options = new primitives.orgdiagram.Config();
                
                options.buttons = [];
                options.templates = [getItemTemplate()];
                options.onItemRender = onTemplateRender;
                options.hasButtons = primitives.common.Enabled.False;
                options.hasSelectorCheckbox = primitives.common.Enabled.False;
                options.leavesPlacementType = primitives.orgdiagram.ChildrenPlacementType.Matrix;
                options.pageFitMode = primitives.common.PageFitMode.None;
                options.orientationType = primitives.common.OrientationType.Top;
                options.horizontalAlignment = primitives.common.HorizontalAlignmentType.Center;
                
                var items = new Array();
                
                ClientPlanSummaryController.getOrganogramData('{!planId}', function(result, event) {
                    if(result.length > 0) {
                        var arrayElements = JSON.parse(result);
                        
                        for(var i = 0; i < arrayElements.length; i++) {
                            var el = arrayElements[i];
                            
                            items.push(new primitives.orgdiagram.ItemConfig({
                                id: el.id,
                                parent: el.parent,
                                description: el.description,
                                templateName: itemTemplate
                            }));
                        }
                        
                        options.items = items;
                        $('#organogram').orgDiagram(options);
                    } else {
                        console.log('no data in organogram');
                    }
                    createMap();
                },
                { escape: false });
            }
            
            function getItemTemplate() {
                var result = new primitives.orgdiagram.TemplateConfig();
                result.name = itemTemplate;
                result.itemSize = new primitives.common.Size(150, 45);
                result.minimizedItemSize = new primitives.common.Size(0,0,0,0);
                result.highlightPadding = new primitives.common.Thickness(0,0,0,0);
                result.cursorPadding = new primitives.common.Thickness(0,0,0,0);
                
                var template = jQuery(
                    '<div class="bp-item bp-corner-all bt-item-frame" style="overflow: visible;background-color: white;">'
                    + '<div style="width: 150px;height: 100%;display: inline-block;">'
                    +   '<div class="orgItemDescription" style="position: absolute;top: 7px;left: 2px;width: 150px;color: black;font-size: 90%;"/>'
                    + '</div>'
                    + '</div>'
                    ).css({
                        width: result.itemSize.width + "px",
                        height: result.itemSize.height + "px"
                    }).addClass("bp-item bp-corner-all bt-item-frame");
                    
                result.itemTemplate = template.wrap('<div>').parent().html();
                
                return result;
            }
            
            function onTemplateRender(event, data) {
                var itemConfig = data.context;
                var id = itemConfig['id'];
                
                var element = data.element.find('.orgItemDescription');
                element.text(itemConfig['description']);
                element.attr('id', id);
                
                var editButton = data.element.find('#menu-27-0');
                editButton.attr('onclick', 'showOrgItemEditModal(\'' + id +'\');return false;');
                
                var removeButton = data.element.find('#menu-27-1');
                removeButton.attr('onclick', 'removeItem(\'' + id +'\');return false;');
            }
            //******************* end of organogram functions ******************************************
            
            //******************* start of map functions ***********************************************
            function createMap() {
                //ClientPlanSummaryController.queryCountries();
                ClientPlanSummaryController.queryCountries('{!planId}', onCountriesQueried, { escape: false });
            }
            
            function onCountriesQueried(result, event) {
                if(result == null || result == false) {
                    showAlert('{!$Label.errMsg_ErrorLoadingData}');
                    endLoading();
                } else {
                    var mapDataJson = JSON.parse(result);
                    processCountriesData(mapDataJson);
                    createStakeholdersHierarchy();
                }
            }
            
            function processCountriesData(data) {
                renderVectorMap();
            
                var mapDataList = {};
                for(var i = 0; i < data.length; i++) {
                    mapDataList[data[i].countryCode] = data[i].color;
                    //primaryBankMap[data[i].countryCode] = data[i].primaryBank;
                }
                $('#vectorMap').vectorMap('set', 'colors', mapDataList);
            }
            
            function renderVectorMap() {
                //var mapBankNameList = {};
                //mapBankNameList['us'] = '<div class="presenceMapPin">USA!</div>';
                //mapBankNameList['nl'] = '<div class="presenceMapPin">Howzit</div>';

                $('#vectorMap').vectorMap({ 
                    map: 'world_en',
                    borderColor: '#818181',
                    borderOpacity: 0.2,
                    borderWidth: 1,
                    onLabelShow: function(event, label, code) {
                        //CREI: Bug in JQVMAP library does not show DRC label correctly. 
                        if(code == 'cd') {
                            label.text('Democratic Republic of the Congo');
                        }
                    },
                    enableZoom: true
                    //,pins: mapBankNameList
                });

                $('#vectorMap g').attr('transform', 'scale(1) translate(0, 0)');
            }
            //******************* end of map functions *************************************************
            
            //******************* start of stakeholders hierarchy functions ****************************
            var stakeholdersData;

            function createStakeholdersHierarchy() {
                var options = new primitives.orgdiagram.Config();
                options.templates = [getContactTemplate()];
                options.onItemRender = onStakeholdersHierarchyTemplateRender;
                options.hasButtons = primitives.common.Enabled.False;
                options.hasSelectorCheckbox = primitives.common.Enabled.False;
                options.leavesPlacementType = primitives.orgdiagram.ChildrenPlacementType.Matrix;
                options.pageFitMode = primitives.common.PageFitMode.None;
                options.orientationType = primitives.common.OrientationType.Top;
                options.horizontalAlignment = primitives.common.HorizontalAlignmentType.Center;
                
                var items = new Array();

                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ClientPlanSummaryController.getStakeholdersHierarchyData}',
                    '{!planId}',
                    function(result, event) {
                        if(result.length > 0) {
                        
                            var arrayElements = JSON.parse(result);
                            stakeholdersData = arrayElements;
                            
                            createBarclaysContactsTable(arrayElements, false);

                            for (var i = 0; i < arrayElements.length; i++) {
                                var el = arrayElements[i];
                                
                                items.push(new primitives.orgdiagram.ItemConfig({
                                    id: el.id,
                                    aprId: el.aprId,
                                    parent: el.parent,
                                    title: el.title,
                                    jobRole: el.jobRole,
                                    jobTitle: el.jobTitle,
                                    clientStrength: el.clientStrength,
                                    templateName: contactTemplate,
                                    clientStrength: el.clientStrength,
                                    comment: el.comment,
                                    barclaysContacts: el.barclaysContacts
                                }));
                            }
                        }

                        options.items = items;

                        $('#stakeholdersHierarchy').orgDiagram(options);
                        
                        endLoading();
                    },
                    { escape: false }
                );
            }
            
            function onStakeholdersHierarchyTemplateRender(event, data) {
                var itemConfig = data.context;
                data.element.find('.mapSlider').attr({"data-slider-value": itemConfig.clientStrength});
                data.element.find('.mapSlider').attr({"aprid": itemConfig.aprId});

                var editButton = data.element.find('#menu-27-0');
                editButton.attr('onclick', 'showEditContactModal(\''    + itemConfig.aprId +'\', \'' 
                                                                        + itemConfig.title + '\', \'' 
                                                                        + itemConfig.clientStrength + '\');return false;');
                var removeButton = data.element.find('#menu-27-1');
                removeButton.attr('onclick', 'removeContact(\'' + itemConfig.id +'\');return false;');
                var goToContactButton = data.element.find('#menu-27-2');
                goToContactButton.attr('onclick', 'openContact(\'' + itemConfig.id +'\');return false;');

                var progressBar = data.element.find('#influence');
                var strength = itemConfig.clientStrength;
                if (strength == '1 - Weak') {
                    strength = '1';
                } else if (strength == '5 - Strong') {
                    strength = '5';
                }
                progressBar.val(strength*20);
                
                var fields = ["title", "jobRole", "jobTitle", "clientStrength"];
                for(var index = 0; index < fields.length; index++) {
                    var field = fields[index];
                    
                    var element = data.element.find("[name=" + field + "]");
                    if (element.text() != itemConfig[field]) {
                        element.text(itemConfig[field]);
                        element.attr("title", itemConfig[field]);
                    }
                }

                data.element.find('.barclays-contacts').empty();
                var barclaysContacts = itemConfig.barclaysContacts;
                if(barclaysContacts != null && barclaysContacts.length > 0){
                    data.element.find('.barclays-contacts').append(
                        '<div class="slds-grid slds-grid--align-spread slds-has-flexi-truncate">'
                        +  '<span class="slds-tile__title slds-truncate">Barclays contacts ('+barclaysContacts.length+')</span>'
                        +'</div>'
                    );
                } else {
                    data.element.find('.barclays-contacts').append(
                        '<div>'
                        +  '<button class="slds-button slds-button--neutral slds-button--small" onclick="showAddBarclaysContactModal(\''+itemConfig.aprId+'\');return false;">Add Barclays contact</button>'
                        +'</div>'
                    );
                }
            }
            
            function getContactTemplate() {
                var result = new primitives.orgdiagram.TemplateConfig();
                result.name = contactTemplate;
                
                result.itemSize = new primitives.common.Size(220, 115);
                result.minimizedItemSize = new primitives.common.Size(3, 3);
                
                var itemTemplate = jQuery(
                    '<div class="bp-item bp-corner-all bt-item-frame">'
                    +  '<div name="id" class="slds-grid slds-wrap" style="height: '+result.itemSize.height+'px; padding: 6px;">'
                    +    '<div class="slds-col slds-size--1-of-1 slds-align-top">'
                    +      '<div class="slds-grid slds-grid--align-spread slds-has-flexi-truncate">'
                    +        '<div class="slds-media slds-tile slds-hint-parent">'
                    +          '<div class="slds-media__figure">'
                    +            '<span class="slds-avatar slds-avatar--circle slds-avatar--small">'
                    +              '<img src="{!URLFOR($Resource.SLDS092, 'assets/images/rsz_avatar2.jpg')}" alt="" />'
                    +            '</span>'
                    +          '</div>'
                    +          '<div class="slds-media__body">'
                    +            '<p name="title" class="slds-tile__title slds-text-body--regular"></p>'
                    +            '<div class="slds-tile__detail slds-text-body--small">'
                    +              '<p name="jobTitle" class="slds-tile__detail slds-text-body--small"></p>'
                    +            '</div>'
                    +          '</div>'
                    +        '</div>'
                    +      '</div>'
                    +    '</div>'
                    +    '<div class="slds-col slds-size--1-of-1 slds-align-middle">'
                    +      '<dl class="dl--horizontal slds-text-body--small">'
                    +        '<dt class="slds-dl--horizontal__label">'
                    +          '<p class="slds-truncate">Influence</p>'
                    +        '</dt>'
                    +        '<dd class="slds-dl--horizontal__detail slds-tile__meta">'
                    +           '<progress id="influence" value="80" max="100"></progress>'
                    +        '</dd>'
                    +      '</dl>'
                    +      '<dl class="dl--horizontal slds-text-body--small">'
                    +        '<dt class="slds-dl--horizontal__label">'
                    +          '<p class="slds-truncate">Job role</p>'
                    +        '</dt>'
                    +        '<dd class="slds-dl--horizontal__detail slds-tile__meta">'
                    +          '<div name="jobRole"></div>'
                    +        '</dd>'
                    +      '</dl>'
                    +    '</div>'
                    +  '</div>'
                    + '</div>'
                    ).addClass("bp-item bp-corner-all bt-item-frame");
                
                /*
                var avatar = $('#avatar').text();
                $(itemTemplate).find('img').each( function() {
                    $(this).prop('src', avatar);
                });
                */
                result.itemTemplate = itemTemplate.wrap('<div>').parent().html();
                
                
                return result;
            }
            
            function createBarclaysContactsTable(data, addAll) {
                var html = '';
                for(var i = 0; i < data.length; i++) {
                    if(addAll || data[i].barclaysContacts.length > 0) {
                        html += prepareContactRow(data[i]);
                    }
                }
                
                $('#barclaysContacts tbody').html(html);
            }
            
            function prepareContactRow(data) {
                var html = '<tr>';
                html += '<td class="paddingRight1">' + data.title + '</td>';
                html += '<td class="paddingRight1">' + data.jobRole + '</td>';

                if(data.barclaysContacts.length > 0) {
                    html += '<td class="paddingRight1">' + data.barclaysContacts[0].name + '</td>';
                    html += '<td>' + data.barclaysContacts[0].clientStrength + '</td>';
                } else {
                    html += '<td/><td/>';
                }
                html += '</tr>';
                return html;
            }
            //******************* end of stakeholders hierarchy functions ******************************
            
            function prepareTextareas() {
                var content = $('#sectorOverviewSource').text();
                //CREI: special quotes corrupts pdf text. catch and replace them in the sector overview section
                content = content.replace(new RegExp('’', 'g'), '\'');
                $('#sectorOverview').html(content);
                
                content = $('#clientOverviewSource').text();
                //CREI: special quotes corrupts pdf text. catch and replace them in the client overview section
                content = content.replace(new RegExp('’', 'g'), '\'');
                $('#clientOverview').html(content);
                
                //strategies text areas
                $('.strategy').each( function() {
                    var clientSource = $(this).find('.clientStrategySource').text();
                    var bankSource  = $(this).find('.bankStrategySource').text();
                    
                    $(this).find('.clientStrategy').html(clientSource);
                    $(this).find('.bankStrategy').html(bankSource);
                });
            }
            
            function replaceNewLines() {
                $('.description').each( function() {
                    var content = $(this).html();
                    content = content.replace(new RegExp('\n', 'g'), '<br>');
                    content = content.replace(new RegExp('•', 'g'), '-');
                    $(this).html(content);
                });
            }
            
            /*
            function prepareGenerateButtonOnClick() {
                $('#generateButton').click( function() {
                    showGeneratePdfModal();
                });
            }
            */

            function prepareGenerateButtonOnClick() {
                //Disable the print new button
                $('#printNewButton').attr("disabled", true);

                //Show the 'old' button if it exists
                $('#previousPdfWrapper').css('display','block');

                //Enable the generate button
                $('#generateButton').attr("disabled", false);

                $('#generateButton').click( function() {
                    showGeneratePdfModal();
                });
            }

            function onBeforeGeneratePdf() {
                closeGeneratePdfModal();

                startLoading('Preparing PDF');

                //First generate static images - these will chain and then call the FinishPrintingPdf when done.
                generatePresenceImage();         
            }

            function finishPrintingPdf() {
                //startLoading('Generate full PDF');

                //Then call actual server-side generatePDF
                //What were the pages we want to see as selected on the modal?
                var pageOverview = $("#pageOverviewCheckbox").is(':checked');
                var pageClientSector = $("#pageClientSectorCheckbox").is(':checked');
                var pageOwnership = $("#pageOwnershipCheckbox").is(':checked');
                var pageSwot = $("#pageSwotCheckbox").is(':checked');
                var pageStakeHolders = $("#pageStakeHoldersCheckbox").is(':checked');
                var pagePresence = $("#pagePresenceCheckbox").is(':checked');
                var pageFinancials = $("#pageFinancialsCheckbox").is(':checked');
                var pageFacilitiesBreakdown = $("#pageFacilitiesBreakdownCheckbox").is(':checked');
                var pageRevenuesByProduct = $("#pageRevenuesByProductCheckbox").is(':checked');
                var pageStrategies = $("#pageStrategiesCheckbox").is(':checked');
                var pageOpportunities = $("#pageOpportunitiesCheckbox").is(':checked');
                var pageContactBios = $("#pageContactBioCheckbox").is(':checked');

                generatePdfJS(pageOverview, pageClientSector, pageOwnership, pageSwot, pageStakeHolders, pagePresence, pageFinancials, pageFacilitiesBreakdown, pageRevenuesByProduct, pageStrategies, pageOpportunities,pageContactBios);
                
                //endLoading();
            }
            
            function skipElem(element, renderer) {
                return true;
            }
            
            function showGeneratePdfModal() {
                closeToast();
                $('#generatePdfModal').show();
            }
            
            function closeGeneratePdfModal() {
                $('#generatePdfModal').hide();
            }
            
            /*
            function onBeforeGeneratePdf() {
                closeGeneratePdfModal();
                startLoading('Preparing PDF');
            
                $('#stakeholdersHierarchy .Layer7 progress').each( function() {
                    var value = $(this).val();
                    var parent = $(this).parent();
                    
                    $(this).remove();
                    $(parent).html(value + ' / 100');
                });

                createBarclaysContactsTable(stakeholdersData, true);
                
                $('.dynamicFontSize').css("fontSize", 16);
                $('.dynamicFontSize14').css("fontSize", 14);
                $('.white').css("color", "white");
                
                titlePageGenerated = $("#titlePageCheckbox").is(':checked');
                overviewGenerated = $("#overviewCheckbox").is(':checked');
                financialsGenerated = $("#financialsCheckbox").is(':checked');
                presenceGenerated = $("#presenceCheckbox").is(':checked');
                stakeholdersGenerated = $("#stakeholdersCheckbox").is(':checked');
                strategyGenerated = $("#strategyCheckbox").is(':checked');
                planGenerated = $("#planCheckbox").is(':checked');
                
                var pdf = new jsPDF('l', 'pt', 'a4');
                var pdfpage = 1;
                pdf.setFontSize(14);
                pdf.setFont("helvetica");
                
                generatePdfPart1(pdf,pdfpage);
            }
            */
            
            /*
            function generatePdfPart1(pdf,pdfpage) {
                if(titlePageGenerated) {
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(18);
                    var accName = $('#navbarBrandBottom').text();
                    pdf.text(40, 30, accName);
                    pdf.text(40, 60, 'Client Plan Summary');
                    
                    pdf.setFontSize(14);
                    pdf.text(40, 90, 'Title page');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfDetailsTable(), prepareDataOfDetailsTable(), {
                        
                        startY: 100,
                        drawHeaderRow: function() {
                            return false;
                        },
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 250, 'Client Team');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfTeamTable(), prepareDataOfTeamTable(), {
                        startY: 260,
                        drawHeaderRow: function() {
                            return false;
                        },
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                }
                
                generatePdfPart5(pdf,pdfpage);
            }
            */

            /*
            function addFootertoPdF(pdf,pdfpage){ 
                //pdf.text('page ' + pdfpage,400,550 ); //print number bottom center
                return ++pdfpage;
            }
            */
            
            /*
            function generatePdfPart5(pdf,pdfpage) {
                if(stakeholdersGenerated) {
            
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Stakeholders');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    //stakeholder hierarchy svg (lines) modifications to be able to render it to pdf
                    
                    //var hierarchyLines = $('#stakeholdersHierarchy .Layer2 svg');
                    //$(hierarchyLines).removeAttr('version');
                    //$(hierarchyLines).removeAttr('viewbox');
                    //$(hierarchyLines).removeAttr('style');
                    //$(hierarchyLines).attr('width', '975px');
                    //$(hierarchyLines).attr('height', '575px');
                    
                    //html2canvas($('#stakeholdersHierarchy'), {
                    //    onrendered: function (canvas) {
                    //        var img = canvas.toDataURL("image/png");
                    //        
                    //        pdf.addImage(img, 'PNG', 40, 40, 750, 450, 'stakeholderRelationships');
                    //        generatePdfPart5BarclaysContacts(pdf,pdfpage);
                    //    }
                    //});

                    generatePdfPart5BarclaysContacts(pdf,pdfpage);
                } else {
                    generatePdfPart2(pdf,pdfpage);
                }
            }
            */
            
            /*
            function generatePdfPart5BarclaysContacts(pdf,pdfpage) {
                pdfpage = addFootertoPdF(pdf,pdfpage);
                //pdf.addPage();
                
                pdf.setFontType("bold");
                pdf.setFontSize(14);
                pdf.text(40, 40, 'Barclays Contacts');
                pdf.setFontType("");
                pdf.setFontSize(12);
                
                pdf.autoTable(prepareColumnsOfBarclaysContactsTable(), prepareDataOfBarclaysContactsTable(), {
                    startY: 50,
                    margin: 40,
                    styles: {overflow: 'linebreak', font: "helvetica"},
                    bodyStyles: {valign: 'top'}
                });
                
                generatePdfPart2(pdf,pdfpage);
            }
            */
            
            /*
            function generatePdfPart2(pdf,pdfpage) {
                if(overviewGenerated) {
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Overview');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    var source = $('#overviewPanel')[0];
                    var specialElementHandlers = {
                        '#sectorOverviewSource' : skipElem,
                        '#clientOverviewSource' : skipElem
                    };
                    
                    pdf.fromHTML(
                        source
                        , margins.left
                        , 30
                        , {
                            'width': margins.width
                        ,   'elementHandlers': specialElementHandlers
                        },
                        function (dispose) {
                            generatePdfPart2Organogram(pdf,pdfpage);
                        },
                        margins
                    );  
                } else {
                    generatePdfPart3(pdf,pdfpage); 
                }
            }
            */
            
            var organogramWidth;
            var organogramHeight;
            
            /*
            function generatePdfPart2Organogram(pdf,pdfpage) {
                if('{!plan.Org_Structure_Image_ID__c}' != '') {
                    pdfpage = addFootertoPdF(pdf,pdfpage);
                    pdf.addPage();
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, '{!$Label.lbl_CompanyOrganogram}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    var contentType = '';
                    var data = '';
                
                    var img = new Image();
                    img.src = data;
                    
                    var elem = $('#orgStructureImage img');
                    organogramWidth = $(elem).width();
                    organogramHeight = $(elem).height();
                    fixOrganogramSize();
                    
                    var imageType = contentType.indexOf('png') == -1 ? 'JPEG' : 'PNG';
                    pdf.addImage(img, 'PNG', 10, 40, organogramWidth, organogramHeight, 'organogram');
                    generatePdfPart3(pdf,pdfpage);
                } else if($('#organogram .bp-item').length > 0) {
                    pdfpage = addFootertoPdF(pdf,pdfpage);
                    pdf.addPage();
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, '{!$Label.lbl_CompanyOrganogram}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    //organogram svg (lines) modifications to be able to render it to pdf
                    var organogramLines = $('#organogram .Layer2 svg');
                    $(organogramLines).removeAttr('version');
                    $(organogramLines).removeAttr('viewbox');
                    $(organogramLines).removeAttr('style');
                    $(organogramLines).attr('width', '750px');
                    $(organogramLines).attr('height', '450px');
                    
                    html2canvas($('#organogram'), {
                        onrendered: function (canvas) {
                        
                            var img = canvas.toDataURL("image/png");
                            pdf.addImage(img, 'PNG', 40, 40, 750, 450, 'organogram');
                            generatePdfPart3(pdf,pdfpage);
                        }
                    });
                } else {
                    generatePdfPart3(pdf,pdfpage);
                }
            }
            */
            
            var maxOrganogramHeight = 500;
            var maxOrganogramWidth = 800;
            
            /*
            function fixOrganogramSize() {
                if(organogramWidth > maxOrganogramWidth) {
                    var ratio = maxOrganogramWidth / organogramWidth;
                    organogramHeight = organogramHeight * ratio;
                    organogramWidth = maxOrganogramWidth;
                    
                    fixOrganogramSize();
                } else if (organogramHeight > maxOrganogramHeight) {
                    var ratio = maxOrganogramHeight / organogramHeight;
                    organogramWidth = organogramWidth * ratio;
                    organogramHeight = maxOrganogramHeight;
                
                    fixOrganogramSize();
                }
            }
            */
            
            /*
            function generatePdfPart3(pdf,pdfpage) {
                if(financialsGenerated) {
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Client Financials');
                    pdf.text(40, 50, 'Client Rating');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfRatingTable(), prepareDataOfRatingTable(), {
                        startY: 60,
                        drawHeaderRow: function() {
                            return false;
                        },
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                    
                    pdf.autoTable(prepareColumnsOfFinancialsTable(), prepareDataOfFinancialsTable(), {
                        startY: 220,
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                    pdfpage = addFootertoPdF(pdf,pdfpage);
                    pdf.addPage();
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Total Facilities Breakdown Schedule');
                    pdf.text(40, 50, 'ABSA / Barclays Facilities');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfAbsaFacilitiesTable(), prepareDataOfAbsaFacilitiesTable(), {
                        startY: 60,
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200},
                            2: {columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                    
                    var startY = pdf.autoTableEndPosY() + 30;
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, startY, 'Other Bank Facilities');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    startY += 10
                    pdf.autoTable(prepareColumnsOfOtherFacilitiesTable(), prepareDataOfOtherFacilitiesTable(), {
                        startY: startY,
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', columnWidth: 200},
                            2: {columnWidth: 200}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak', font: "helvetica"},
                        bodyStyles: {valign: 'top'}
                    });
                    
                    startY = pdf.autoTableEndPosY() + 30;
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, startY, 'Security currently held by ABSA / Barclays');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    var source = $('#absaSec tbody')[0];
                    
                    var specialElementHandlers = {
                    };
                    
                    pdf.fromHTML(
                        source
                        , margins.left
                        , startY
                        , {
                            'width': margins.width
                        ,   'elementHandlers': specialElementHandlers
                        },
                        function (dispose) {
                            generatePdfPart4(pdf,pdfpage);
                        },
                        margins
                    ); 
                } else {
                    generatePdfPart4(pdf,pdfpage);
                }
            }
            */
            
            /*
            function generatePdfPart4(pdf,pdfpage) {
                if(presenceGenerated) {
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Country Presence');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    html2canvas($('#pdfContent4'), {
                        onrendered: function (canvas) {
                            var img = canvas.toDataURL("image/png");
                            
                            pdf.addImage(img, 'PNG', 40, 40, 750, 450, 'presenceMap');
                            generatePdfPart6(pdf,pdfpage);
                        }
                    });
                } else {
                    generatePdfPart6(pdf,pdfpage);
                }
            }
            */
            
            /*
            function generatePdfPart6(pdf,pdfpage) {
                if(strategyGenerated) {
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    somethingAlreadyRendered = true;
                    
                    pdf.setFontType("bold");
                    pdf.setFontSize(14);
                    pdf.text(40, 20, 'Strategy');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    var source = $('#pdfContent6')[0];
                    var specialElementHandlers = {
                        '#clientStrategySource': skipElem,
                        '#bankStrategySource': skipElem
                    };
                    
                    pdf.fromHTML(
                        source
                        , margins.left
                        , margins.top
                        , {
                            'width': margins.width,
                            'elementHandlers': specialElementHandlers,
                            'margin': 1,
                            'pagesplit': true
                        },
                        function (dispose) {
                            generatePdfPart7(pdf,pdfpage);
                        },
                        margins
                    );
                } else {
                    generatePdfPart7(pdf,pdfpage);
                }
            }
            */
            
            /*
            function generatePdfPart7(pdf,pdfpage) {
                if(planGenerated) {  
                    if(somethingAlreadyRendered) {
                        pdfpage = addFootertoPdF(pdf,pdfpage);
                        pdf.addPage();
                    }
                    
                    pdf.setFontSize(14);
                    pdf.setFontType("bold");
                    pdf.text(40, 20, '{!$Label.lbl_Plan}');
                    pdf.text(40, 50, '{!$Label.lbl_BudgetRevenue}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfProductionTable(), prepareDataOfProductionTable(), {
                        startY: 60,
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold'}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak'},
                        headerStyles: {valign: 'middle'},
                        bodyStyles: {valign: 'top'}
                    });

                    //------------------ Revenue By Product Table -------------------
                    pdfpage = addFootertoPdF(pdf,pdfpage);
                    pdf.addPage();

                    pdf.setFontSize(14);
                    pdf.setFontType("bold");
                    pdf.text(40, 20, '{!$Label.lbl_RevenuesByProduct}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfRevByProdTable(), prepareDataOfRevByProdTable(), {
                        startY: 60,
                        columnStyles: {
                            1: {fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold'}
                        },
                        margin: 40,
                        styles: {overflow: 'linebreak'},
                        headerStyles: {valign: 'middle'},
                        bodyStyles: {valign: 'top'}
                    });

                    //------------------
                    
                    var startY = pdf.autoTableEndPosY() + 30;
                    pdf.setFontSize(14);
                    pdf.setFontType("bold");
                    pdf.text(40, startY, '{!$Label.lbl_PotentialOpportunities}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfPotOptyTable(), prepareDataOfPotOptyTable(), {
                        startY: startY + 10,
                        margin: 40,
                        styles: {overflow: 'linebreak'},
                        headerStyles: {valign: 'middle'},
                        bodyStyles: {valign: 'top'}
                    });
                    
                    startY = pdf.autoTableEndPosY() + 30;
                    pdf.setFontSize(14);
                    pdf.setFontType("bold");
                    pdf.text(40, startY, '{!$Label.lbl_OpenOpportunities}');
                    pdf.setFontType("");
                    pdf.setFontSize(12);
                    
                    pdf.autoTable(prepareColumnsOfOptyTable(), prepareDataOfOptyTable(), {
                        startY: startY + 10,
                        margin: 40,
                        styles: {overflow: 'linebreak'},
                        headerStyles: {valign: 'middle'},
                        bodyStyles: {valign: 'top'}
                    });
                }
                somethingAlreadyRendered = false;
                
                onBeforeUploadPdf(pdf,pdfpage);
            }
            */
            
            /*
            //MSR 14/06 : Changing color code from F4F6F9 to FFFFFF
            function onBeforeUploadPdf(pdf,pdfpage) {
                startLoading('Removing previous PDF');

                createBarclaysContactsTable(stakeholdersData, false);
                
                $('.dynamicFontSize').css("fontSize", 14);
                $('.dynamicFontSize14').css("fontSize", 12);
                $('.white').css("color", "#FFFFFF");
                
                pdfOutput = pdf.output('datauristring');
                
                sforce.connection.sessionId = "{!$Api.Session_ID}";
                var result = sforce.connection.query('SELECT Id FROM Attachment WHERE ParentId = \'{!planId}\' AND ContentType = \'application/pdf\'');
                var records = result.getArray("records");
                
                if(records.length > 0) {
                    var ids = [];
                    
                    for(var i = 0; i < records.length; i++) {
                        ids.push(records[i].Id);
                    }
        
                    var delResult = sforce.connection.deleteIds(ids);
                }
                
                startLoading('Uploading PDF');
                
                var attachment         = new sforce.SObject('Attachment');
                attachment.Name        = 'GeneratedPdf.pdf';
                attachment.IsPrivate   = false;
                attachment.ContentType = 'application/pdf';
                attachment.Body        = pdfOutput.split(',')[1];
                attachment.ParentId    = '{!planId}';
                
                sforce.connection.create([attachment],{onSuccess: onSuccessfullySaved, onFailure: onFailure});
            }
            */
            
            /*
            function onSuccessfullySaved(data) {
                endLoading();
                
                var url = attachmentBaseUrl + data[0].id;
                $('#previousPdfWrapper a').prop('href', url);
                $('#previousPdfWrapper').show();
               
                window.open(url);
            }
            */
            
            /*
            function onFailure(data) {
                endLoading();
                console.log(data);
                showToast('An error occured during saving PDF.');
            }
            */
            
            /*
            function prepareColumnsOfProductionTable() {
                var row = $('#productionTable thead tr');
                return [
                    {title: $(row).find('th:nth-child(1)').text(), dataKey: "1"},
                    {title: $(row).find('th:nth-child(2)').text(), dataKey: "2"},
                    {title: $(row).find('th:nth-child(3)').text(), dataKey: "3"},
                    {title: $(row).find('th:nth-child(4)').text(), dataKey: "4"},
                    {title: $(row).find('th:nth-child(5)').text(), dataKey: "5"},
                    {title: $(row).find('th:nth-child(6)').text(), dataKey: "6"},
                    {title: $(row).find('th:nth-child(7)').text(), dataKey: "7"},
                    {title: $(row).find('th:nth-child(8)').text(), dataKey: "8"},
                    {title: $(row).find('th:nth-child(9)').text(), dataKey: "9"},
                    {title: $(row).find('th:nth-child(10)').text(), dataKey: "10"},
                    {title: $(row).find('th:nth-child(11)').text(), dataKey: "11"},
                    {title: $(row).find('th:nth-child(12)').text(), dataKey: "12"},
                ];
            }
            
            function prepareDataOfProductionTable() {
                var data = [];
                
                $('#productionTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('td:nth-child(1)').text(),
                        2: $(this).find('td:nth-child(2)').text(),
                        3: $(this).find('td:nth-child(3)').text(),
                        4: $(this).find('td:nth-child(4)').text(),
                        5: $(this).find('td:nth-child(5)').text(),
                        6: $(this).find('td:nth-child(6)').text(),
                        7: $(this).find('td:nth-child(7)').text(),
                        8: $(this).find('td:nth-child(8)').text(),
                        9: $(this).find('td:nth-child(9)').text(),
                        10: $(this).find('td:nth-child(10)').text(),
                        11: $(this).find('td:nth-child(11)').text(),
                        12: $(this).find('td:nth-child(12)').text()
                    });
                });
                return data;
            }

            function prepareColumnsOfRevByProdTable() {
                var row = $('#revByProdTable thead tr');
                return [
                    {title: $(row).find('th:nth-child(1)').text(), dataKey: "1"},
                    {title: $(row).find('th:nth-child(2)').text(), dataKey: "2"},
                    {title: $(row).find('th:nth-child(3)').text(), dataKey: "3"},
                    {title: $(row).find('th:nth-child(4)').text(), dataKey: "4"},
                    {title: $(row).find('th:nth-child(5)').text(), dataKey: "5"},
                    {title: $(row).find('th:nth-child(6)').text(), dataKey: "6"},
                    {title: $(row).find('th:nth-child(7)').text(), dataKey: "7"},
                ];
            }
            
            function prepareDataOfRevByProdTable() {
                var data = [];
                
                $('#revByProdTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('td:nth-child(1)').text(),
                        2: $(this).find('td:nth-child(2)').text(),
                        3: $(this).find('td:nth-child(3)').text(),
                        4: $(this).find('td:nth-child(4)').text(),
                        5: $(this).find('td:nth-child(5)').text(),
                        6: $(this).find('td:nth-child(6)').text(),
                        7: $(this).find('td:nth-child(7)').text(),
                    });
                });
                return data;
            }

            
            function prepareColumnsOfPotOptyTable() {
                var row = $('#potOptysTable thead tr');
                return [
                    {title: $(row).find('th:nth-child(1)').text(), dataKey: "1"},
                    {title: $(row).find('th:nth-child(2)').text(), dataKey: "2"},
                    {title: $(row).find('th:nth-child(3)').text(), dataKey: "3"},
                    {title: $(row).find('th:nth-child(4)').text(), dataKey: "4"},
                    {title: $(row).find('th:nth-child(5)').text(), dataKey: "5"},
                    {title: $(row).find('th:nth-child(6)').text(), dataKey: "6"}
                ];
            }
            
            function prepareDataOfPotOptyTable() {
                var data = [];
                
                $('#potOptysTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('td:nth-child(1)').text(),
                        2: $(this).find('td:nth-child(2)').text(),
                        3: $(this).find('td:nth-child(3)').text(),
                        4: $(this).find('td:nth-child(4)').text(),
                        5: $(this).find('td:nth-child(5)').text(),
                        6: $(this).find('td:nth-child(6)').text()
                    });
                });
                return data;
            }
            
            function prepareColumnsOfOptyTable() {
                var row = $('#optysTable thead tr');
                return [
                    {title: $(row).find('th:nth-child(1)').text(), dataKey: "1"},
                    {title: $(row).find('th:nth-child(2)').text(), dataKey: "2"},
                    {title: $(row).find('th:nth-child(3)').text(), dataKey: "3"},
                    {title: $(row).find('th:nth-child(4)').text(), dataKey: "4"},
                    {title: $(row).find('th:nth-child(5)').text(), dataKey: "5"},
                    {title: $(row).find('th:nth-child(6)').text(), dataKey: "6"},
                    {title: $(row).find('th:nth-child(7)').text(), dataKey: "7"}
                ];
            }
            
            function prepareDataOfOptyTable() {
                var data = [];
                
                $('#optysTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('td:nth-child(1)').text(),
                        2: $(this).find('td:nth-child(2)').text(),
                        3: $(this).find('td:nth-child(3)').text(),
                        4: $(this).find('td:nth-child(4)').text(),
                        5: $(this).find('td:nth-child(5)').text(),
                        6: $(this).find('td:nth-child(6)').text(),
                        7: $(this).find('td:nth-child(7)').text()
                    });
                });
                return data;
            }
            
            function prepareDataOfDetailsTable() {
                var data = [];
                
                $('#detailsTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('th').text(),
                        2: $(this).find('td').text()
                    });
                });
                return data;
            }
            
            function prepareColumnsOfDetailsTable() {
                return [
                    {title: "", dataKey: "1"},
                    {title: "", dataKey: "2"}
                ];
            }
            
            function prepareDataOfTeamTable() {
                var data = [];
                
                $('#teamTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('td:nth-child(1) span').text(),
                        2: $(this).find('td:nth-child(2) span').text()
                    });
                });
                return data;
            }
            
            function prepareColumnsOfTeamTable() {
                var row = $('#teamTable thead tr');
                return [
                    {title: $(row).find('th:nth-child(1)').text(), dataKey: "1"},
                    {title: $(row).find('th:nth-child(2)').text(), dataKey: "2"}
                ];
            }
            
            function prepareDataOfRatingTable() {
                var data = [];
                
                $('#ratingTable tbody tr').each( function() {
                    data.push({
                        1: $(this).find('th').text(),
                        2: $(this).find('td').text()
                    });
                });
                return data;
            }
            
            function prepareColumnsOfRatingTable() {
                return [
                    {title: "", dataKey: "1"},
                    {title: "", dataKey: "2"}
                ];
            }
            
            function prepareDataOfFinancialsTable() {
                var data = [];
                
                $('#financialsTable tbody tr').each( function() {
                    var row = {1: $(this).find('th').text()};
                    
                    $(this).find('td').each( function(index) {
                        row[index + 2] = $(this).text();
                    });
                    data.push(row);
                });
                return data;
            }
            
            function prepareColumnsOfFinancialsTable() {
                var row = $('#financialsTable thead tr');
                
                var data = [];
                $(row).find('th').each( function(index) {
                    index++;
                    var title = {title: $(this).text(), dataKey: "" + index};
                    data.push(title);
                });
                return data;
            }
            
            function prepareDataOfAbsaFacilitiesTable() {
                var data = [];
                
                $('#absaFacilities tbody tr').each( function() {
                    var row = {};
                    row[1] = $(this).find('td:first-child').text();
                    row[2] = $(this).find('td:nth-child(2)').text();
                    row[3] = $(this).find('td:nth-child(3)').text();
                    data.push(row);
                });
                return data;
            }
            
            function prepareColumnsOfAbsaFacilitiesTable() {
                var row = $('#absaFacilities thead tr');
                
                var data = [];
                $(row).find('th').each( function(index) {
                    index++;
                    var title = {title: $(this).text(), dataKey: "" + index};
                    data.push(title);
                });
                return data;
            }
            
            function prepareDataOfOtherFacilitiesTable() {
                var data = [];
                
                $('#otherFac tbody tr').each( function() {
                    var row = {};
                    row[1] = $(this).find('td:first-child').text();
                    row[2] = $(this).find('td:nth-child(2)').text();
                    row[3] = $(this).find('td:nth-child(3)').text();
                    data.push(row);
                });
                return data;
            }
            
            function prepareColumnsOfOtherFacilitiesTable() {
                var row = $('#otherFac thead tr');
                
                var data = [];
                $(row).find('th').each( function(index) {
                    index++;
                    var title = {title: $(this).text(), dataKey: "" + index};
                    data.push(title);
                });
                return data;
            }
            
            function prepareDataOfAbsaSecurityTable() {
                var data = [];
                
                $('#absaSec tbody tr').each( function() {
                    var row = {};
                    row[1] = $(this).find('td:first-child').html();
                    row[2] = $(this).find('td:nth-child(2)').text();
                    data.push(row);
                });
                return data;
            }
            
            function prepareColumnsOfAbsaSecurityTable() {
                var row = $('#absaSec thead tr');
                
                var data = [];
                $(row).find('th').each( function(index) {
                    index++;
                    var title = {title: $(this).text(), dataKey: "" + index};
                    data.push(title);
                });
                return data;
            }
            
            function prepareDataOfBarclaysContactsTable() {
                var data = [];
                
                $('#barclaysContacts tbody tr').each( function() {
                    var row = {};
                    row[1] = $(this).find('td:first-child').text();
                    row[2] = $(this).find('td:nth-child(2)').text();
                    row[3] = $(this).find('td:nth-child(3)').text();
                    row[4] = $(this).find('td:nth-child(4)').text();
                    data.push(row);
                });
                return data;
            }
            
            function prepareColumnsOfBarclaysContactsTable() {
                var row = $('#barclaysContacts thead tr');
                
                var data = [];
                $(row).find('th').each( function(index) {
                    index++;
                    var title = {title: $(this).text(), dataKey: "" + index};
                    data.push(title);
                });
                return data;
            }
            */
            
            function prepareAbsaSecurityRichtexts() {
                $('.absSecEditable').each(function() {
                    var content = $(this).siblings('.absSecEditableSource').text();
                    $(this).html(content);
                    this.contentEditable = false;
                });
                
                $('.absSecEditableSource').remove();
            }
            
            function trimFields() {
                $('.toTrim').each( function() {
                    var value = $(this).text();
                    value = value.trim();
                    $(this).text(value);
                });
            }
        </script>
        <script>
            /* Generate static Presence image for inclusion in PDF generation */
            function generatePresenceImage() {
                startLoading('Generating Presence Image');

                html2canvas($('#pdfContent4'), {
                    onrendered: function (canvas) {
                        var imgSrc = canvas.toDataURL("image/png");
                        submitPresenceImgtoController(imgSrc);
                    }
                });
            }

            function submitPresenceImgtoController(imgSrc) {
                startLoading('Saving Presence Image');
                ClientPlanSummaryController.savePresenceImg('{!planId}', imgSrc, submitPresenceImgHandler);
            }

            function submitPresenceImgHandler(result, event) {
                if(event.status) {
                    //Saved ok - continue with the Group Image
                    generateGroupImage();
                } else if(event.type === 'exception') {
                    alert('exception on storing PresenceMap: ' + event.message);
                } else {
                    alert('exception on storing PresenceMap: ' + event.message);
                }
            }

            /* Generate static Group image for inclusion in PDF generation */
            function generateGroupImage() {
                startLoading('Generate Group Structure Image');

                //Only if we have Organogram data
                if($('#organogram .bp-item').length > 0) {
                    //organogram svg (lines) modifications to be able to render it to pdf
                    var organogramLines = $('#organogram .Layer2 svg');
                    $(organogramLines).removeAttr('version');
                    $(organogramLines).removeAttr('viewbox');
                    $(organogramLines).removeAttr('style');
                    $(organogramLines).attr('width', '750px');
                    $(organogramLines).attr('height', '450px');

                    html2canvas($('#pdfContent2'), {
                        onrendered: function (canvas) {
                            var imgSrc = canvas.toDataURL("image/png");
                            submitGroupImgtoController(imgSrc);
                        }
                    });
                } else {
                    //If not send a 1-character src indicating we don't have one
                    submitGroupImgtoController('x');
                }
            }

            function submitGroupImgtoController(imgSrc) {
                startLoading('Saving Group Structure Image');
                ClientPlanSummaryController.saveGroupImg('{!planId}', imgSrc, submitGroupImgHandler);
            }

            function submitGroupImgHandler(result, event) {
                if(event.status) {
                    //Saved ok
                    finishPrintingPdf();
                } else if(event.type === 'exception') {
                    alert('exception on storing GroupMap: ' + event.message);
                } else {
                    alert('exception on storing GroupMap: ' + event.message);
                }
            }
        </script>
        <style>
            .orgItemDescription {
                font-family: Arial, Helvetica, sans-serif;
                padding: 5px;
                word-wrap: break-word;
            }
            
            .orgItemDescription {
                font-family: 'Salesforce Sans', Arial, sans-serif;
            }
        
            .hidden {
                display: none;
            }
        
            .wholePage {
                width: 1000px;
                margin: auto;
                padding-top: 2em;
                font-size: 13px;
                font-family: 'Salesforce Sans', Arial, sans-serif;
            }
            
            .labelValueWrapper {
                width: 100%;
            }
            
            .label {
                color: gray;
                width: 40em;
            }
            
            .white {
                color: #F4F6F9;
            }
            
            .inline {
                display: inline-block;
            }
            
            .filterLabelUnderline {
                width: 100%;
                height: 0.3em;
            }
            
            .legendItem {
                padding: 1em;
            }
            
            .heading {
                font-size:14px;
                color: rgb(34, 34, 34);
            }
            
            .bold {
                font-weight: bold;
            }
            
            #productionTable th {
                word-wrap: break-word;
                white-space: normal;
                width: 8%;
            }

            #revByProdTable th {
                word-wrap: break-word;
                white-space: normal;
                width: 8%;
            }

            #revByProdTable .included {
                text-align: center;
                font-weight: bold;
            }
            
            .marginTop1em {
                margin-top: 1em;
            }
            
            .marginTop2em {
                margin-top: 2em;
            }
            
            .marginTop3em {
                margin-top: 3em;
            }
            
            .bottomLine {
                border-bottom: 1px solid #d8dde6;
            }
            
            .topLine {
                border-top: 1px solid #d8dde6;
            }

            .sectionHeader {
                font-weight: bold;
                font-size: 16px;
            }
            
            #orgStructureImage img {
                max-width: 1000px;
                max-height: 600px;
            }
            
            #pdfContent1 {
                margin-top: 3em;
            }
            
            #pageWrapper {
                background-color: #F4F6F9;
            }
            
            #generateButton {
                float: right;
                margin-right: 1em;
            }

            #printNewButton {
                float: right;
                margin-right: 1em;
            }

            #printOldButton {
                float: right;
                margin-right: 1em;
            }
            
            #previousPdfWrapper {
                float: right;
                text-align: center;
                display: inline-block;
            }
            
            #optysTable,
            #potOptysTable {
                width: 100%;
            }
            
            #productionTable th, 
            #productionTable td {
                padding: 0.5em;
            }
            
            #productionTable th, 
            #productionTable td,
            #revByProdTable th,
            #revByProdTable td,
            #potOptysTable th,
            #potOptysTable td,
            #optysTable th,
            #optysTable td {
                color: rgb(34, 34, 34);
                font-size: 12px;
            }
            
            #pageHeaderLabel {
                font-size: 1.5em;
                margin-top: 0.5em;
            }
            
            #detailsPanel {
                padding-top: 1em;
                padding-bottom: 1em;
            }
            
            #overviewPanel,
            #pdfContent3,
            #pdfContent6,
            #pdfContent7 {
                padding-bottom: 1em;
            }
            
            #stakeholdersLabel {
                padding-top: 1em;
            }
            
            #detailsPanel tr th:first-child {
                min-width: 13em;
            }
            
            #pdfContent3 tr th:first-child {
                width: 22em;
            }
            
            .absSecEditableSource {
                display: none;
            }
            .absSecEditable {    
                    max-width: 750px;           
                    white-space: normal;
                    overflow-wrap: break-word;
                    word-wrap: break-word;
            }    
            .width100 {
                width: 100%;
            }
            
            #absaFacilities th,
            #otherFac th {
                width: 30%;
            }
            
            #absaFacilities th:first-child,
            #otherFac th:first-child {
                width: 40%;
            }
            
            #absaSec th:first-child {
                width: 70% !important;
            }
            
            .paddingLeft2em {
                padding-left: 2em;
            }

            #financialsTable .toTrim,
            .paddingRight1 {
                padding-right: 1em;
            }
            
            .presenceMapPin {
                background-color: #FFFFFF;
                border: 1px solid black;
            }
        </style>

        <div class="slds">
            <c:ClientPlanHeader />
            <c:ProgressBarLightning />
            <c:LightningAlert />
            <c:LightningToast />
        </div>

        <apex:includeScript value="{!URLFOR($Resource.jquery_ui, '/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.jquery_ui, '/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css')}"/>
        
        <apex:includeScript value="{!URLFOR($Resource.primitives, 'primitives/primitives.latest.js')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.primitives, 'primitives/primitives.latest.css')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.jquery_vector_map, 'jqvmap.css')}"/>
        <apex:includeScript value="{!URLFOR($Resource.jquery_vector_map, 'jquery.vmap.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.jquery_vector_map, 'jquery.vmap.world.js')}"/>
        <!--<div style="float:left;margin :5px" class="slds">
            <apex:form >
            <apex:outputPanel rendered="{!isGlobalParent}">
           <label   class="slds-form-element__label inputLabel" for="ClientPlans" ><b>
                {!$Label.lblUnderlyingClientPlans}</b>
            </label><br/>
            <apex:SelectList size="1" id="ClientPlans" styleClass="slds-select" value="{!selectedClientPlans}" title="Select Client" onChange="window.open(this.value,'_blank', 'toolbar=0,location=0,menubar=0')">
                <apex:selectOptions value="{!ChildClientPlans}" />
            </apex:SelectList><br/>
           </apex:outputPanel>
            </apex:form>
        </div>-->
        <div id="pageWrapper">
            <apex:outputPanel rendered="{!planLoaded}" layout="block" styleClass="wholePage">
              
                <apex:outputPanel id="buttonWrapperPanel">
                    <div id="docButtonsWrapper" class="slds">
                        <apex:pageMessages id="pageMsg"/>

                        <apex:outputPanel rendered="{!documentId != null}">
                            <div id="previousPdfWrapper" style="display: none">
                                <button id="printOldButton" class="slds-button slds-button--brand" onclick="window.open('/servlet/servlet.FileDownload?file={!documentId}')">
                                    {!$Label.lbl_ViewCurrentSummary}
                                </button>
                                <br/>
                                <span style="font-size: 10px; width: 100%; text-align: center;">({!documentTimestamp} GMT)</span>
                            </div>
                        </apex:outputPanel>

                        <button id="printNewButton" class="slds-button slds-button--brand" onclick="window.open('/servlet/servlet.FileDownload?file={!documentId}')">{!$Label.lbl_ViewNewSummary}</button>
                        <button id="generateButton" disabled="true" class="slds-button slds-button--brand">{!$Label.lbl_GenerateNewSummary}</button>
                    </div>
                </apex:outputPanel>
                
                <div id="pageHeaderLabel">{!$Label.lbl_ClientPlanSummary}</div>
            
                <div id="pdfContent1">
                    <div>
                        <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_TitlePage}"/>
                    </div>
                    <div id="detailsPanel" class="topLine">
                        <table id="detailsTable">
                            <tbody>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.Status__c.Label}" /></th>
                                    <td>{!detailsCtrl.plan.Status__c}</td>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.Expansion_Policy__c.Label}" /></th>
                                    <td>{!detailsCtrl.plan.Expansion_Policy__c}</td>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.DG__c.Label}" /></th>
                                    <td>{!detailsCtrl.plan.DG__c}</td>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_CoverageBanker}" /></th>
                                    <td>{!detailsCtrl.plan.Relationship__r.Owner.Name}</td>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.LastModifiedDate.Label}" /></th>
                                    <td class="toTrim">
                                        <apex:outputText value="{0, date, dd/MM/yyyy}">
                                            <apex:param value="{!detailsCtrl.plan.LastModifiedDate}" />
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="white">a</div>
                        <div class="heading"><apex:outputText value="{!$Label.lbl_ClientTeam}" /></div>
                        <div class="tableWrapper">
                            <table id="teamTable">
                                <thead>
                                    <tr>
                                        <th scope="col">
                                            <apex:outputText value="{!$ObjectType.Account_Team_Member__c.fields.Team_Member__c.Label}" />
                                        </th>
                                        <th scope="col">
                                            <apex:outputText value="{!$ObjectType.Account_Team_Member__c.fields.Team_Role__c.Label}" />
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!detailsCtrl.members}" var="member">
                                        <tr>
                                            <td>
                                                <apex:outputField value="{!member.Team_Member__r.Name}" />
                                            </td>
                                            <td>
                                                <apex:outputField value="{!member.Team_Role__c}" />
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                </tbody>
                            </table>
                        </div>
                        <div id="DGFooter" style="font-style:italic;font-size:9px;display:{!IF(detailsCtrl.plan.SDS__c!='' && detailsCtrl.plan.Override_Pull_DG_From_SPEAR__c==false && detailsCtrl.getSelectedSDSClient!='','block','none')}">
                                <apex:outputText value="*DG retrieved based on: {!detailsCtrl.getSelectedSDSClient}"/>
                        </div>
                    </div>

                    <div class="bottomLine">
                        <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Overview}"/>
                    </div>            
                    <div id="overviewPanel" class="marginTop1em">
                        <div class="heading bold dynamicFontSize"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.Sector_Overview__c.Label}" /></div>
                        <div id="sectorOverviewSource" class="hidden">{!SectorOverview}</div>
                        <div id="sectorOverview"/>
                        
                        <div class="heading bold dynamicFontSize"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.Client_Overview__c.Label}" /></div>
                        <div id="clientOverviewSource" class="hidden">{!clientOverview}</div>
                        <div id="clientOverview"/>
                        
                        <div class="white">a</div>
                        <div class="heading bold dynamicFontSize">{!$Label.lbl_SwotAnalysis}</div>
                        <div id="swot">
                            <div id="strengths">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_StrengthsOfClient}" /></div>
                                <apex:repeat value="{!overviewController.strengths}" var="strength">
                                    <div>{!strength.Name}</div>
                                    <div class="description">{!strength.Description__c}</div>
                                </apex:repeat>
                            </div>
                            
                            <div class="white">a</div>
                            <div id="weaknesses">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_WeaknessesOfClient}" /></div>
                                <apex:repeat value="{!overviewController.weaknesses}" var="weakness">
                                    <div>{!weakness.Name}</div>
                                    <div class="description">{!weakness.Description__c}</div>
                                </apex:repeat>
                            </div>
                            
                            <div class="white">a</div>
                            <div id="opportunities">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_OpportunitiesOfClient}" /></div>
                                <apex:repeat value="{!overviewController.opportunities}" var="opty">
                                    <div>{!opty.Name}</div>
                                    <div class="description">{!opty.Description__c}</div>
                                </apex:repeat>
                            </div>
                            
                            <div class="white">a</div>
                            <div id="threats">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_ThreatsOfClient}" /></div>
                                <apex:repeat value="{!overviewController.threats}" var="t">
                                    <div>{!t.Name}</div>
                                    <div class="description">{!t.Description__c}</div>
                                </apex:repeat>
                            </div>
                        </div>

                        <div class="white">a</div>
                        <div class="heading bold dynamicFontSize">{!$Label.lbl_BorrowersGuarantors}</div>
                        <div id="borrowersGuarantors">
                            <div id="borrowers">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_Borrowers}" /></div>
                                <apex:repeat value="{!orgStructureController.borrowers}" var="borrower">
                                    <div>{!borrower.Value__c}</div>
                                </apex:repeat>
                            </div>
                            
                            <div class="white">a</div>
                            <div id="guarantors">
                                <div class="heading"><apex:outputText value="{!$Label.lbl_Guarantors}" /></div>
                                <apex:repeat value="{!orgStructureController.guarantors}" var="guarantor">
                                    <div>{!guarantor.Value__c}</div>
                                </apex:repeat>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bottomLine">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_CompanyOrganogram}"/>
                </div>      
                <div id="pdfContent2" class="">
                    <div class="white">a</div>
                    <div id="organogramWrapper">
                        <div id="orgStructureImage">
                            <apex:image url="/servlet/servlet.FileDownload?file={!plan.Org_Structure_Image_ID__c}" rendered="{!IF(plan.Org_Structure_Image_ID__c == null, false, true)}"/>
                        </div>
                        <div class="slds">
                            <div id="organogram" style="width: 1000px;height: 600px;display:none;"/>
                        </div>
                    </div>
                </div>
                
                <div class="bottomLine">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Environment}"/>
                </div>         
                <div id="pdfContent3" class="">
                    <div class="white">a</div>
                    <div class="heading"><apex:outputText value="{!$Label.lbl_ClientRating}"/></div>
                    
                    <table id="ratingTable">
                        <tbody>
                            <tr>
                                <th scope="row"><apex:outputText value="{!$Label.lbl_TFL}" /></th>
                                <td class="toTrim">
                                    {!financialsController.plan.CurrencyIsoCode}
                                    <apex:outputText value="{0, number, ###,##0}">
                                        <apex:param value="{!financialsController.plan.TFL__c}"/>
                                    </apex:outputText>
                                </td>                     
                            </tr>
                            <tr>
                                <th scope="row"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.RoRWA_Existing__c.Label}" /></th>
                                <td class="toTrim">
                                    <apex:outputText value="{!financialsController.plan.RoRWA_Existing__c}" />%
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><apex:outputText value="{!$Label.lbl_FAISStatus}" /></th>
                                <td>{!financialsController.plan.FAIS_Status__c}</td>
                            </tr>
                            <tr>
                                <th scope="row"><apex:outputText value="{!$Label.lbl_LastReviewDate}" /></th>
                                <td class="toTrim">
                                    <apex:outputText value="{0, date, dd/MM/yyyy}">
                                        <apex:param value="{!financialsController.plan.Last_Review_Date__c}" />
                                    </apex:outputText>
                                </td>
                            </tr>

                            <tr>
                                <th scope="row"><apex:outputText value="{!$Label.lbl_ClientsYearEnd}" /></th>
                                <td>{!financialsController.plan.Financial_Year_End__c}</td>
                            </tr>
                            <tr>
                                <th scope="row"><apex:outputText value="{!$Label.lbl_DateOfLatestAFS}" /></th>
                                <td class="toTrim">
                                    <apex:outputText value="{0, date, dd/MM/yyyy}">
                                        <apex:param value="{!financialsController.plan.Latest_Audited_Financial_Statement__c}" />
                                    </apex:outputText>
                                </td>
                            </tr>
                            
                        </tbody>
                    </table>
                    
                    <apex:outputPanel rendered="{!!financialsController.financeList.empty}">
                        <div class="white">a</div>
                        <table id="financialsTable">
                            <thead>
                                <tr>
                                    <th/>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <th>
                                        	<apex:outputText value="{!f.Month__c} " rendered="{!f.Month__c != null && (f.Financial_Results__c == null || f.Financial_Results__c != 'Audited Full Year')}"/>
                                            <apex:outputText value="{!financialsController.plan.Financial_Year_End__c} " rendered="{!financialsController.plan.Financial_Year_End__c != null && f.Financial_Results__c != null && f.Financial_Results__c == 'Audited Full Year'}"/>
                                            {!f.Year__c}
                                        </th>
                                    </apex:repeat>
                                </tr>
                            </thead>
                            <tbody>
								<tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Financial_Results__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputText value="{!f.Financial_Results__c}"/>
                                        </td>
                                    </apex:repeat>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_Turnover}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Turnover__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                </tr>
                                <tr>
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_EBITDA}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.EBITDA__c}"/>
                                            </apex:outputText>       
                                        </td>
                                    </apex:repeat>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}"> 
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.EBITDA_Margin__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                             <apex:outputLabel value="{!VALUE(TEXT(f.EBITDA_Margin__c))}%" />   
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Net_Interest_Expense_Income__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Net_Interest_Expense_Income__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_NetInterestExpenseIncomeBAGLFacilitiesOnly}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Net_Interest_Expense_BAGL_facilities__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.PAT__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.PAT__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_TotalAssets}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Total_Assets__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_TotalTangibleAssets}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Total_Tangible_Assets__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Gross_Debt__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Gross_Debt__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Subordinated_Shareholder_Loans__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Subordinated_Shareholder_Loans__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Cash_and_cash_equivalents__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Cash_and_cash_equivalents__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                        <th scope="row"><apex:outputText value="{!$Label.lbl_NetDebt}"/></th>
                                        <apex:repeat value="{!financialsController.financeList}" var="f">
                                            <td class="toTrim">
                                                {!f.CurrencyIsoCode}
                                                <apex:outputText value="{0, number, ###,##0}">
                                                    <apex:param value="{!f.Net_Debt__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                        <th scope="row"><apex:outputText value="{!$Label.lbl_NetWorth}"/></th>
                                        <apex:repeat value="{!financialsController.financeList}" var="f">
                                            <td class="toTrim">
                                                {!f.CurrencyIsoCode}
                                                <apex:outputText value="{0, number, ###,##0}">
                                                    <apex:param value="{!f.Net_Worth__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                        <th scope="row"><apex:outputText value="{!$Label.lbl_NetWorth}"/></th>
                                        <apex:repeat value="{!financialsController.financeList}" var="f">
                                            <td class="toTrim">
                                                {!f.CurrencyIsoCode}
                                                <apex:outputText value="{0, number, ###,##0}">
                                                    <apex:param value="{!f.Tangible_Net_Worth__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Total_Liabilities__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Total_Liabilities__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row">
									<apex:outputText value="{!$Label.lbl_CashGeneratedByOperations}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Cash_Generated_by_Operations__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Cash_flow_from_operating_activities_Adj__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Cash_flow_from_operating_activities_Adj__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Capex__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Capex__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_FreeCashFlow}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Free_Cash_Flow__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Net_cash_generation_utilization__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Net_cash_generation_utilization__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.EBITDA_Net_Interest_cover__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.EBITDA_Net_Interest_cover__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row">{!$Label.lbl_NetDebtEbitda}</th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputLabel value="{!f.Net_Debt_Cash_Ebitda__c}" />
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row">{!$Label.lbl_GrossDebtEbitda}</th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputLabel value="{!f.Gross_Debt_Cash_Ebitda__c}" />
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Tangible_Gearing_Net_Debt_TNW__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Tangible_Gearing_Net_Debt_TNW__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Net_Asset_Value__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Net_Asset_Value__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                
                               <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.EPS__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.EPS__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.EBIT__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.EBIT__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <th scope="row"><apex:outputText value="{!$ObjectType.Financial_Information__c.fields.Market_Cap__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Market_Cap__c}"/>
                                            </apex:outputText>     
                                        </td>
                                    </apex:repeat>
                                </tr>
                                <tr>
                                    <th scope="row">
                                        <apex:outputText value="{!$ObjectType.Financial_Information__c.fields.ROE__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputText value="{!f.ROE__c}"/>                                                
                                        </td>
                                    </apex:repeat>
                                </tr>
								<tr>
                                    <th scope="row">
                                        <apex:outputText value="{!$ObjectType.Financial_Information__c.fields.ROA__c.Label}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputText value="{!f.ROA__c}"/>                                                
                                        </td>
                                    </apex:repeat>
                                </tr>
                              <!--  <tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_TotalInterestBearingDebt}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            {!f.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!f.Total_Interest_Bearing_Debt__c}"/>
                                            </apex:outputText>    
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr> -->
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_DebtEquity}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputLabel value="{!VALUE(TEXT(f.Debt_Equity__c))}%" /> 
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_CurrentRatio}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputLabel value="{!f.Current_Ratio__c}" />  
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
								<tr>
                                    <apex:outputPanel rendered="{!financialsController.plan.Financial_Information_Image_ID__c == null}">
                                    <th scope="row"><apex:outputText value="{!$Label.lbl_InterestCoverRatio}"/></th>
                                    <apex:repeat value="{!financialsController.financeList}" var="f">
                                        <td class="toTrim">
                                            <apex:outputLabel value="{!f.Interest_Cover_Ratio__c}" />
                                        </td>
                                    </apex:repeat>
                                    </apex:outputPanel>
                                </tr>
                                
                            </tbody>
                        </table>
                    </apex:outputPanel>

                    <apex:outputPanel rendered="{!financialsController.financeList.empty || financialsController.plan.Financial_Information_Image_ID__c != null}">
                        <table id="financialsTable">
                            <tr>
                                <td>
                                    <apex:image styleClass="standaloneImgGroup" url="/servlet/servlet.FileDownload?file={!financialsController.plan.Financial_Information_Image_ID__c}" rendered="{!financialsController.plan.Financial_Information_Image_ID__c != null}"/>
                                </td>
                            </tr>
                        </table>
                    </apex:outputPanel>
                    
                    <div class="white">a</div>
                    <div class="white">a</div>
                    
                    <apex:outputPanel rendered="{!(financialsController.plan.Financial_Information_Image_ID__c != null || !financialsController.financeList.Empty)&&(financialsController.plan.FinancialCommentary__c != NULL && financialsController.plan.FinancialCommentary__c != '')}">
                        <div class="heading"><apex:outputText value="{!$ObjectType.Client_Plan__c.fields.FinancialCommentary__c.Label}"/></div>
                        <table id="financialCommentaryTable">
                            <tr>
                                <td>
                                    <apex:outputText value="{!financialsController.plan.FinancialCommentary__c}" escape="false"/>
                                </td>
                            </tr>
                        </table>
                        <div class="white">a</div>
                    	<div class="white">a</div>
                    </apex:outputPanel>
                    
                    <div class="heading"><apex:outputText value="{!$Label.lbl_TotalFacilitiesBreakdownSchedule}"/></div>
                    
                    <div class="white">a</div>
                    <div><apex:outputText value="{!$Label.lbl_OtherFacilities}"/></div>
                    <table id="otherFac" class="width100">
                        <thead>
                            <tr>
                                <th><apex:outputText value="{!$ObjectType.Client_Plan_Facility__c.fields.Bank__c.Label}" /></th>
                                <th><apex:outputText value="{!$ObjectType.Client_Plan_Facility__c.fields.Country__c.Label}" /></th>
                                <th><apex:outputText value="{!$ObjectType.Client_Plan_Facility__c.fields.Product__c.Label}" /></th>
                                <th><apex:outputText value="{!$ObjectType.Client_Plan_Facility__c.fields.Limit__c.Label}" /></th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!financialsController.otherFacility}" var="othFac">
                                <tr>
                                    <td><apex:outputText value="{!othFac.Bank__c}" /></td>
                                    <td><apex:outputText value="{!othFac.Country__c}" /></td>
                                    <td><apex:outputText value="{!othFac.Product_Level_3__r.Name}" /></td>
                                    <td class="toTrim">
                                        {!othFac.CurrencyIsoCode}
                                        <apex:outputText value="{0, number, ###,##0}">
                                            <apex:param value="{!othFac.Limit__c}"/>
                                        </apex:outputText>      
                                    </td>
                                </tr>
                            </apex:repeat>
                        </tbody>
                    </table>
                    
                    <div class="white">a</div>
                    <div><apex:outputText value="{!$Label.lbl_AbsaSecurity}"/></div>
                    <div id="absaSecWrapper">
                        <table id="absaSec" class="width100">
                            <thead>
                                <tr>
                                    <th><apex:outputText value="{!$ObjectType.Client_Plan_Security__c.fields.Security_Description__c.Label}" /></th>
                                    <th><apex:outputText value="{!$ObjectType.Client_Plan_Security__c.fields.Value__c.Label}" /></th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!financialsController.absaSecurity}" var="absSec">
                                    <tr>
                                        <td>
                                            <div id="absSecEditableSource" class="absSecEditableSource">{!absSec.Security_Description__c}</div>
                                            <div class="absSecEditable"></div>
                                        </td>
                                        <td class="absSecValue">
                                            {!absSec.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!absSec.Value__c}"/>
                                            </apex:outputText> 
                                        </td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="bottomLine heading marginTop1em">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Presence}"/>
                </div>   
                <div id="pdfContent4">
                    <div>
                        <div class="inline legendItem">
                            <span>{!$Label.lbl_PrimaryBank}</span>
                            <div class="filterLabelUnderline" style="background-color: rgb(0, 174, 239);"/>
                        </div>
                        <div class="inline legendItem">
                            <span>{!$Label.lbl_NotPrimaryBank}</span>
                            <div class="filterLabelUnderline" style="background-color: rgb(128, 128, 105);"/>
                        </div>
                        <div class="inline legendItem">
                            <span>{!$Label.lbl_PresentButNotBanking}</span>
                            <div class="filterLabelUnderline" style="background-color: rgb(255, 160, 0);"/>
                        </div>
                        <div class="inline legendItem">
                            <span>{!$Label.lbl_BarclaysNotPresent}</span>
                            <div class="filterLabelUnderline" style="background-color: rgb(0, 0, 0);"/>
                        </div>
                    </div>
                    <div id="vectorMap" style="width: 1000px;height: 600px;"/>
                </div>

                <div class="bottomLine heading marginTop1em">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Stakeholders}"/>
                </div>   

                <div id="pdfContent5" class="slds">
                    <div id="stakeholdersHierarchy" style="width: 1000px;height: 600px;"/>
                </div>
                
                <div id="barclaysContacts" class="marginTop2em">
                    <div class="heading">{!$Label.lbl_BarclaysContacts}</div>
                    <table>
                        <thead>
                            <tr>
                                <th class="paddingRight1" style="padding-bottom: 0.5em;padding-top: 0.5em;">{!$Label.lbl_ClientContact}</th>
                                <th class="paddingRight1">{!$Label.lbl_ClientRole}</th>
                                <th class="paddingRight1">{!$Label.lbl_PrimaryBarclaysContact}</th>
                                <th>{!$Label.lbl_RelationshipStrength}</th>
                            </tr>
                        </thead>
                        <tbody/>
                    </table>
                </div>

                <div class="bottomLine marginTop1em">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Strategy}"/>
                </div>           
                <div id="pdfContent6" class="">
                    <apex:repeat value="{!strategyController.strategies}" var="strategy">
                        <apex:outputPanel layout="block" styleClass="white" rendered="{!strategy != strategyController.strategies[0]}">
                            a<br/>a
                        </apex:outputPanel>
                        
                        <div class="strategy">
                            <div class="heading bold dynamicFontSize">{!strategy.Name}</div>
                            
                            <div class="white">a</div>
                            <div class="bold dynamicFontSize">{!$ObjectType.Client_Plan_Strategy__c.fields.Client_Strategy__c.Label}</div>
                            <div id="clientStrategySource" class="clientStrategySource hidden">{!strategy.Client_Strategy__c}</div>
                            <div class="clientStrategy" />
                            
                            <div class="white">a</div>
                            <div class="bold dynamicFontSize">{!$ObjectType.Client_Plan_Strategy__c.fields.Bank_Strategy__c.Label}</div>
                            <div id="bankStrategySource" class="bankStrategySource hidden">{!strategy.Bank_Strategy__c}</div>
                            <div class="bankStrategy" />
                            
                            <div class="white">a</div>
                            <div class="bold dynamicFontSize14">{!$Label.lbl_Opportunities}</div>
                            <div>
                                <apex:repeat value="{!strategyController.optysMap[strategy.Id]}" var="opty">
                                    <div>{!opty.Name} - {!opty.Probability}%</div>
                                </apex:repeat>
                            </div>
                            
                            <div class="white">a</div>
                            <div class="bold dynamicFontSize14">{!$Label.lbl_PotentialOpportunities}</div>
                            <div>
                                <apex:repeat value="{!strategyController.unqOptysMap[strategy.Id]}" var="opty">
                                    <div>{!opty.Name} - {!opty.Probability__c}</div>
                                </apex:repeat>
                            </div>
                        </div>
                    </apex:repeat>
                </div>


                <div class="bottomLine">
                    <apex:outputText styleClass="sectionHeader" value="{!$Label.lbl_Plan}"/>
                </div>         

                <div id="pdfContent7" class="">
                    <div class="heading marginTop1em">
                        <apex:outputText value="{!$Label.lbl_BudgetRevenue}"/>
                    </div>
                    
                    <div class="slds">
                        <table id="productionTable">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Product__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Country__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Maturity_Date__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.LGD__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.DG__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Limit__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Utilisation__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Margin__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.FTP__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Arranging_Fee__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Commitment_Fee__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.RoRWA__c.Label}" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!planController.brs}" var="br">
                                    <tr>
                                        <td>
                                            <apex:outputField value="{!br.Product_Level_3__r.Name}" />
                                            <apex:outputPanel layout="none" rendered="{!br.Id == planController.brs[planController.brs.size - 1].Id}">
                                                {!$Label.lbl_Totals}
                                            </apex:outputPanel>    
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.Country__c}" rendered="{!br.Country__c != null}" />
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputText value="{0, date, dd/MM/yyyy}" rendered="{!br.Maturity_Date__c != null}">
                                                <apex:param value="{!br.Maturity_Date__c}" /> 
                                            </apex:outputText>
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.LGD__c}" rendered="{!br.LGD__c != null}" />
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.DG__c}" rendered="{!br.DG__c != null}" />
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputText value="{!IF(br.CurrencyIsoCode != null, br.CurrencyIsoCode, 'ZAR')}" />
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!br.Limit__c}"/>
                                            </apex:outputText>     
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputText value="{!IF(br.CurrencyIsoCode != null, br.CurrencyIsoCode, 'ZAR')}" />
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!br.Utilisation__c}"/>
                                            </apex:outputText> 
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.Margin__c}" rendered="{!br.Margin__c != null}"/>
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.FTP__c}" rendered="{!br.FTP__c != null}"/><apex:outputText value="bps" rendered="{!br.FTP__c != null}"/>
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.Arranging_Fee__c}" rendered="{!br.Arranging_Fee__c != null}"/>
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.Commitment_Fee__c}" rendered="{!br.Commitment_Fee__c != null}"/>
                                        </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!br.RoRWA__c}" rendered="{!br.RoRWA__c != null}"/>
                                        </td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                        <apex:outputPanel >
            <table  >
                    <thead>
                        <tr  >
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.FACILITYPRODUCTDESCRIPTION__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.Country__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.EXPIRYDATE__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.FACILITYAMOUNT__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.LOSSGIVENDEFAULT__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.ACMUTILIZATIONAMOUNT__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.GROSS_MARGIN__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.FTP_bps__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.Net_Margin__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.Arrang_Fee__c.Label}" />
                                </span>
                            </th>
                            <th>
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.COM_FEES__c.Label}" />
                                </span>
                            </th>
                            <th >
                                <span>
                                    <apex:outputText value="{!$ObjectType.ACMFacility__c.fields.RoRWA__c.Label}" />
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <apex:variable value="{!0}" var="acmfsKeyIndex"/>
                        <apex:repeat value="{!acmfsKeys}" var="acmfsKey">
                            <tr id="{!acmfsKey}">
                            	<td colspan="13" bgcolor="#bfbfbf">
                                    {!acmfsLabels[acmfsKeyIndex]}
                                    
                                </td>
                            </tr>
                        	<apex:repeat value="{!acmfsMap[acmfsKey]}" var="acmf">
                                <tr id="{!acmf.Id}" >
                                    <td class="field">
                                        {!acmf.FACILITYPRODUCTDESCRIPTION__c}
                                    </td>
                                  <td class="field">
                                        {!acmf.Country__c}
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{0, date, dd/MM/yyyy}" rendered="{!acmf.EXPIRYDATE__c != null}">
                                            <apex:param value="{!acmf.EXPIRYDATE__c}" /> 
                                        </apex:outputText>
                                    </td>
                                    <td class="field">
                                        {!acmf.FACILITYCURRENCY__c} <apex:outputText value="{0, number, ###,##0}"><apex:param value="{!acmf.FACILITYAMOUNT__c}"/></apex:outputText>
                                    </td>
                                    <td class="field">
                                        {!acmf.LOSSGIVENDEFAULT__c}
                                    </td>
                                    <td class="field">
                                        {!acmf.ACMUTILIZATIONCURRENCY__c} <apex:outputText value="{0, number, ###,##0}"><apex:param value="{!acmf.ACMUTILIZATIONAMOUNT__c}"/></apex:outputText>
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.GROSS_MARGIN__c}" />
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.FTP_bps__c}"/>
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.NET_MARGIN__c}"/>
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.Arrang_Fee__c}"/>
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.COM_FEES__c}"/>
                                    </td>
                                    <td class="field">
                                        <apex:outputText value="{!acmf.RoRWA__c}"/>
                                    </td>
                                    
                                </tr>
                            </apex:repeat>
                            <apex:variable var="acmfsKeyIndex" value="{!acmfsKeyIndex + 1}"/>
                        </apex:repeat>
                    </tbody>
                    </table>
        </apex:outputPanel>    
                        <br/><br/>
                         <apex:outputpanel rendered="{!isGlobalParent}">
 <table>
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Product__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Country__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Maturity_Date__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.LGD__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.DG__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Limit__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Utilisation__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Margin__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.FTP__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Arranging_Fee__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.Commitment_Fee__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Budget_Revenue__c.fields.RoRWA__c.Label}" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            <apex:variable var="cnt" value="{!1}" /> 
                        
                        <apex:repeat value="{!accountListToBudgetRevenues}" var="currentAccount">
                             <tr>
                                <th>{!accountListToBudgetRevenues[currentAccount].Name}</th>
                            </tr>
                            <apex:repeat value="{!clientPlanToBudgetRevenues[currentAccount]}" var="budgetRevenue">
                                <tr >
                                    <td class="toTrim">
                                        <apex:outputText value="{!budgetRevenue.Product_Level_3__r.Name}" />
                                      
                                    </td>
                                  
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Country__c}" />
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputText value="{0, date, dd/MM/yyyy}" >
                                            <apex:param value="{!budgetRevenue.Maturity_Date__c}" /> 
                                        </apex:outputText>
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.LGD__c}" />
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.DG__c}" />
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Limit__c}" />
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Utilisation__c}" />
                                        
                                    </td>
                                    <td class="toTrim" >
                                        <apex:outputField value="{!budgetRevenue.CurrencyIsoCode}" />
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Margin__c}" />
                                    </td>
                                        <td class="toTrim">
                                            <apex:outputField value="{!budgetRevenue.FTP__c}" />
                                            <apex:outputText value="bps" />
                                            
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Arranging_Fee__c}" />
                                        
                                    </td>
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.Commitment_Fee__c}" />
                                        
                                    </td>  
                                    <td class="toTrim">
                                        <apex:outputField value="{!budgetRevenue.RoRWA__c}" />
                                        
                                    </td>           
                                    
                                </tr>
                                
                            </apex:repeat>
                        </apex:repeat>
                            </tbody>
                        </table>
						</apex:outputpanel>
                        <apex:outputPanel rendered="{!planRevByProductController.revByProd != null}">

                            <div class="heading marginTop3em">
                                <apex:outputText value="{!$Label.lbl_RevenuesByProduct}"/>
                            </div>

                            <table id="revByProdTable" class="grid-view">
                                <thead>
                                    <tr>
                                        <th scope="col">&nbsp;</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductIncludedRoRwa}</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductLast12M}</th>
                                        <th scope="col">{!$Label.lbl_RWA}</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductNext12M}</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductNext12MProb}</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductNext1224M}</th>
                                        <th scope="col">{!$Label.lbl_RevenuesByProductNext1224MProb}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductAssetSales}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_AssetSalesFinance__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_AssetSalesFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_AssetSalesFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_AssetSalesFinance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_AssetSalesFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_AssetSalesFinance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_AssetSalesFinance__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductAvgDepBal}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_AverageDepositBalance__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_AverageDepositBalance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_AverageDepositBalance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_AverageDepositBalance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_AverageDepositBalance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_AverageDepositBalance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_AverageDepositBalance__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductCommercialPropertyFinance}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_CommercialPropertyFinance__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_CommercialPropertyFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_CommercialPropertyFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_CommercialPropertyFinance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_CommercialPropertyFinance__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_CommercialPropertyFinance__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_CommercialPropertyFinance__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductDebt}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Debt__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Debt__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Debt__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Debt__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Debt__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Debt__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Debt__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductDeposits}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Deposits__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Deposits__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Deposits__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Deposits__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Deposits__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Deposits__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Deposits__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductEquities}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Equities__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Equities__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Equities__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Equities__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Equities__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Equities__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Equities__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductFixedIncome}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_FixedIncome__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_FixedIncome__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_FixedIncome__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_FixedIncome__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_FixedIncome__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_FixedIncome__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_FixedIncome__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductFX}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_FX__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_FX__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_FX__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_FX__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_FX__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_FX__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_FX__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductOtherMA}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_OtherMADCMECM__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_OtherMADCMECM__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_OtherMADCMECM__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_OtherMADCMECM__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_OtherMADCMECM__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_OtherMADCMECM__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_OtherMADCMECM__c}" /></td>

                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductOtherRBB}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_OtherRBBWealth__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_OtherRBBWealth__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_OtherRBBWealth__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_OtherRBBWealth__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_OtherRBBWealth__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_OtherRBBWealth__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_OtherRBBWealth__c}" /></td>

                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductOtherTrade}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_OtherTrade__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_OtherTrade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_OtherTrade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_OtherTrade__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_OtherTrade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_OtherTrade__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_OtherTrade__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductPassive}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Passive__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Passive__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Passive__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Passive__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Passive__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Passive__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Passive__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductPrimeServices}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_PrimeServices__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_PrimeServices__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_PrimeServices__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_PrimeServices__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_PrimeServices__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_PrimeServices__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_PrimeServices__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductPrivateEquity}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_PrivateEquity__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_PrivateEquity__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_PrivateEquity__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_PrivateEquity__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_PrivateEquity__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_PrivateEquity__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_PrivateEquity__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTrade}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Trade__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Trade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Trade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Trade__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Trade__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Trade__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Trade__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTransProd}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_TransactionProducts__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_TransactionProducts__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_TransactionProducts__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_TransactionProducts__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_TransactionProducts__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_TransactionProducts__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_TransactionProducts__c}" /></td>
                                    </tr>
                                    <!--<tr>
                                        <td>{!$Label.lbl_RevenuesByProductDerivatives}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Derivatives__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Derivatives__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Derivatives__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Derivatives__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Derivatives__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Derivatives__c}" /></td>
                                    </tr>-->
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTreasury}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_Treasury__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Treasury__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_Treasury__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Treasury__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_Treasury__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Treasury__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_Treasury__c}" /></td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductWorkingCapital}</td>
                                        <td class="included"><apex:outputText value="X" rendered="{!planRevByProductController.revByProd.rorwa_WorkingCapital__c}"/></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_WorkingCapital__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.RWA_WorkingCapital__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_WorkingCapital__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F12P_WorkingCapital__c}" /></td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_WorkingCapital__c}" /></td>
                                        <td class="prob"><apex:outputField value="{!planRevByProductController.revByProd.F24P_WorkingCapital__c}" /></td>
                                    </tr>
                                    <!-- Calculations -->
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTotalCon}</td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_H12_Contribution__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F12_Contribution__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F24_Contribution__c}" /></td>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTotalNonLenCon}</td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_H12_Non_Lending_Contrib__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F12_Non_Lending_Contrib__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F24_Non_Lending_Contrib__c}" /></td>
                                        <td>&nbsp;</td>
                                    </tr>                           
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTotalConWei}</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F12_Contrib_Weighted__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F24_Contrib_Weighted__c}" /></td>
                                        <td>&nbsp;</td>
                                    </tr>                                   
                                    <tr>
                                        <td>{!$Label.lbl_RevenuesByProductTotalNonLenConWei}</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F12_Non_Lendng_Contrib_Weighted__c}" /></td>
                                        <td>&nbsp;</td>
                                        <td class="sum"><apex:outputField value="{!planRevByProductController.revByProd.Tot_F24_Non_Lendng_Contrib_Weighted__c}" /></td>
                                        <td>&nbsp;</td>

                                    </tr>
                                    <tr>
										<td>{!$Label.lbl_DerivativesLegacyTotals}</td>
                                        <td>&nbsp;</td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.H12_Derivatives__c}" /></td>
										<td>&nbsp;</td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F12_Derivatives__c}" /></td>
                    					<td>&nbsp;</td>
                                        <td class="rev"><apex:outputField value="{!planRevByProductController.revByProd.F24_Derivatives__c}" /></td>
										<td>&nbsp;</td>
									</tr>
                                </tbody>                                
                            </table>
                        </apex:outputPanel>
                    
                        <div class="heading marginTop3em">
                            <apex:outputText value="{!$Label.lbl_PotentialFutureOpps}"/>
                        </div>

                        <table id="potOptysTable">
                            <thead>
                                <tr>
                                    <th scope="col" style="width: 24%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Name.Label}" />
                                    </th>
                                    <th scope="col" style="width: 21%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Product__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 20%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Stage__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 10%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Close_Date__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 15%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Probability__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Type__c.Label}" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!planController.unqOptys}" var="opty">
                                    <tr>
                                        <td><apex:outputField value="{!opty.Name}" /></td>
                                        <td>
                                            <apex:outputField value="{!opty.Product_Level_3__r.Name}" rendered="{!opty.Product_Level_3__r != null}"/>
                                            <apex:outputField value="{!opty.Product_Level_2__r.Name}" rendered="{!opty.Product_Level_3__r == null && opty.Product_Level_2__r != null}" />
                                            <apex:outputField value="{!opty.Product_Level_1__r.Name}" rendered="{!opty.Product_Level_3__r == null && opty.Product_Level_2__r == null && opty.Product_Level_1__r != null}" />
                                        </td>
                                        <td><apex:outputField value="{!opty.Stage__c}" /></td>
                                        <td>
                                            <apex:outputText value="{0, date, dd/MM/yyyy}">
                                                <apex:param value="{!opty.Close_Date__c}" /> 
                                            </apex:outputText>
                                        </td>
                                        <td><apex:outputText value="{!opty.Probability__c}" /></td>
                                        <td><apex:outputField value="{!opty.Type__c}" /></td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                   
                        <br/><br/>
                        <apex:outputpanel rendered="{!isGlobalParent}">
                <table >
                    <thead>
                        <tr>
                                    <th scope="col" style="width: 24%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Name.Label}" />
                                    </th>
                                    <th scope="col" style="width: 21%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Product__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 20%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Stage__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 10%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Close_Date__c.Label}" />
                                    </th>
                                    <th scope="col" style="width: 15%;">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Probability__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Potential_Opportunity__c.fields.Type__c.Label}" />
                                    </th>
                         </tr>
                    </thead>
                    <tbody>
                        <apex:repeat value="{!accountListToPotentialOpps}" var="currentAccount">
                            <tr>
                                <th>{!accountListToPotentialOpps[currentAccount].Name}</th>
                            </tr>
                            <apex:repeat value="{!clientPlanToPotentialOpportunities[currentAccount]}" var="potentialOpp">
                                <tr id="{!potentialOpp.Id}" class="slds-hint-parent">
                                    <td class="potOptyName">
                                        <apex:outputText value="{!potentialOpp.Name}" />
                                    </td>
                                    <td class="potOptyProductName">
                                        <apex:outputText value="{!potentialOpp.Product_Level_3__r.Name}" rendered="{!potentialOpp.Product_Level_3__r != null}"/>
                                        <apex:outputText value="{!potentialOpp.Product_Level_2__r.Name}" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r != null}" />
                                        <apex:outputText value="{!potentialOpp.Product_Level_1__r.Name}" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r == null && potentialOpp.Product_Level_1__r != null}" />
                                    </td>
                                    <td class="potOptyProductId" style="display: none;">
                                        <apex:outputText value="{!potentialOpp.Product_Level_3__r.Id}" rendered="{!potentialOpp.Product_Level_3__r != null}"/>
                                        <apex:outputText value="{!potentialOpp.Product_Level_2__r.Id}" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r != null}" />
                                        <apex:outputText value="{!potentialOpp.Product_Level_1__r.Id}" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r == null && potentialOpp.Product_Level_1__r != null}" />
                                    </td>
                                    <td class="potOptyProductLevel" style="display: none;">
                                        <apex:outputText value="3" rendered="{!potentialOpp.Product_Level_3__r != null}"/>
                                        <apex:outputText value="2" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r != null}" />
                                        <apex:outputText value="1" rendered="{!potentialOpp.Product_Level_3__r == null && potentialOpp.Product_Level_2__r == null && potentialOpp.Product_Level_1__r != null}" />
                                    </td>
                                    <td class="potOptyStage">
                                        <apex:outputText value="{!potentialOpp.Stage__c}" />
                                    </td>
                                    <td class="potOptyCloseDate">
                                        <apex:outputText value="{0, date, dd/MM/yyyy}">
                                            <apex:param value="{!potentialOpp.Close_Date__c}" /> 
                                        </apex:outputText>
                                    </td>                            
                                    <td>
                                        <apex:outputText value="{!potentialOpp.Probability__c}" />
                                    </td>
                                    <td class="potOptyType">
                                        <apex:outputText value="{!potentialOpp.Type__c}" />
                                    </td>
                                   
                                </tr>
                            </apex:repeat>
                        </apex:repeat>
                    </tbody>
                </table>
                </apex:outputpanel>
                        <div class="heading marginTop3em"><apex:outputText value="{!$Label.lbl_OpenOpportunities}"/></div>
                        <table id="optysTable">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Name.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Total_Balance_Facility_Size__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.OwnerId.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.CloseDate.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Probability.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Annualised_Income__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.StageName.Label}" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!planController.pipelineOptys}" var="opty">
                                    <tr>
                                        <td><apex:outputField value="{!opty.Name}" /></td>
                                        <td class="toTrim">
                                            {!opty.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!opty.Total_Balance_Facility_Size__c}"/>
                                            </apex:outputText>        
                                        </td>
                                        <td><apex:outputField value="{!opty.Owner.Name}" /></td>
                                        <td>
                                            <apex:outputText value="{0, date, dd/MM/yyyy}">
                                                <apex:param value="{!opty.CloseDate}" /> 
                                            </apex:outputText>
                                        </td>
                                        <td><apex:outputField value="{!opty.Probability}" /></td>
                                        <td class="toTrim">
                                            {!opty.CurrencyIsoCode}
                                            <apex:outputText value="{0, number, ###,##0}">
                                                <apex:param value="{!opty.Annualised_Income__c}"/>
                                            </apex:outputText>    
                                        </td>
                                        <td><apex:outputField value="{!opty.StageName}" /></td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                        
                        <br/><br/>
                        <apex:outputpanel rendered="{!isGlobalParent}">
            <table>
                    <thead>
                         <tr>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Name.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Total_Balance_Facility_Size__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.OwnerId.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.CloseDate.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Probability.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.Annualised_Income__c.Label}" />
                                    </th>
                                    <th scope="col">
                                        <apex:outputText value="{!$ObjectType.Opportunity.fields.StageName.Label}" />
                                    </th>
                                </tr>
                    </thead>
                    <tbody>
                        <apex:repeat value="{!accountListToOpps}" var="currentAccount">
                            <tr>
                                <th>{!accountListToOpps[currentAccount].Name}</th>
                            </tr>
                            <apex:repeat value="{!clientPlanToOpportunities[currentAccount]}" var="currentOpportnity">
                                <tr class="slds-hint-parent">
                                    <td>
                                        <apex:outputField value="{!currentOpportnity.Name}" />
                                    </td>
                                    <td>
                                        {!currentOpportnity.Total_Balance_Facility_Size__c}
                                    </td>  
                                    <td>
                                    <apex:outputField value="{!currentOpportnity.Owner.Name}" />
                                </td>
                                <td>
                                    <apex:outputText value="{0, date, dd/MM/yyyy}">
                                        <apex:param value="{!currentOpportnity.CloseDate}" />
                                    </apex:outputText>
                                </td>
                                <td>
                                    <apex:outputText value="{!currentOpportnity.Probability}%" />
                                </td>                            
                                <td>
                                    <apex:outputField value="{!currentOpportnity.Annualised_Income__c}" />
                                </td>                            
                                <td>
                                    <apex:outputField value="{!currentOpportnity.StageName}" />
                                </td> 
                                </tr>
                            </apex:repeat>
                        </apex:repeat>
                    </tbody>
                </table> 
                </apex:outputpanel>
                    </div>
                </div>
            </apex:outputPanel>

            <div id="generatePdfModal" style="display:none;" class="slds">
                <div aria-hidden="false" role="dialog" class="slds-modal slds-fade-in-open" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <div class="slds-modal__container">
                        <div class="slds-modal__header">
                            <h2 class="slds-text-heading--medium">Generate PDF</h2>
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="closeGeneratePdfModal();return false;">
                                <svg aria-hidden="true" class="slds-button__icon slds-button__icon--large">
                                    <use xlink:href="{!URLFOR($Resource.SLDS092, 'assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                </svg>
                            </button>
                        </div>
                        <div class="slds-modal__content">
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageOverviewCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageOverviewCheckbox" checked="true" disabled="true" />
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_TitlePage}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageClientSectorCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageClientSectorCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_ClientSectorOverview}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageOwnershipCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageOwnershipCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_OwnershipStructure}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageSwotCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageSwotCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_SwotAnalysis}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pagePresenceCheckbox">
                                    <input name="checkbox" type="checkbox" id="pagePresenceCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_Presence}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageFinancialsCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageFinancialsCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_Environment}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageFacilitiesBreakdownCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageFacilitiesBreakdownCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_TotalFacilitiesBreakdownSchedule}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageRevenuesByProductCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageRevenuesByProductCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_RevenuesByProduct}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageStrategiesCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageStrategiesCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_Strategy}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageOpportunitiesCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageOpportunitiesCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_Opportunities}</span>
                                </label>
                            </div>
                            <div class="slds-form-element">
                                <label class="slds-checkbox" for="pageContactBioCheckbox">
                                    <input name="checkbox" type="checkbox" id="pageContactBioCheckbox" checked="true"/>
                                    <span class="slds-checkbox--faux"></span>
                                    <span class="slds-form-element__label">{!$Label.lbl_ContactBio}</span>
                                </label>	
                            </div>
                        </div>
                        <div class="slds-modal__footer">
                            <button class="slds-button slds-button--neutral" onclick="closeGeneratePdfModal();return false;">Cancel</button>
                            <button class="slds-button slds-button--neutral slds-button--brand" onclick="onBeforeGeneratePdf();return false;">Generate</button>
                        </div>
                    </div>
                </div>
                <div class="slds-modal-backdrop slds-modal-backdrop--open"></div>
            </div>
        </div>
    </apex:outputPanel>

    <apex:form id="theForm">
        <apex:actionStatus id="processing" onstart="console.log('Start processing'); startLoading('Preparing PDF')" onstop="console.log('Stop processing'); endLoading()"/>
        <apex:actionFunction action="{!generatePdf}" name="generatePdfJS" reRender="buttonWrapperPanel" status="processing">
            <apex:param name="pageOverview" assignTo="{!pageOverview}" value="" />
            <apex:param name="pageClientSector" assignTo="{!pageClientSector}" value="" />
            <apex:param name="pageOwnership" assignTo="{!pageOwnership}" value="" />
            <apex:param name="pageSwot" assignTo="{!pageSwot}" value="" />
            <apex:param name="pageStakeHolders" assignTo="{!pageStakeHolders}" value="" />
            <apex:param name="pagePresence" assignTo="{!pagePresence}" value="" />
            <apex:param name="pageFinancials" assignTo="{!pageFinancials}" value="" />
            <apex:param name="pageFacilitiesBreakdown" assignTo="{!pageFacilitiesBreakdown}" value="" />
            <apex:param name="pageRevenuesByProduct" assignTo="{!pageRevenuesByProduct}" value="" />
            <apex:param name="pageStrategies" assignTo="{!pageStrategies}" value="" />
            <apex:param name="pageOpportunities" assignTo="{!pageOpportunities}" value="" />
            <apex:param name="pageContactBios" assignTo="{!pageContactBios}" value="" />
        </apex:actionFunction>
    </apex:form>
</apex:page>