<aura:component controller="ClientPlanStrategyControllerMobile">
	
    <aura:attribute name="planId" type="Id" required="true" />
    <aura:attribute name="strategyId" type="Id" required="true" />
    <aura:attribute name="optyId" type="Id" required="true" />
    <aura:attribute name="timestamp" type="String" required="true" />
    <aura:attribute name="showProgressBar" type="Boolean" required="false" default="false" />
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler event="aura:doneRendering" action="{!c.doneRendering}"/>
    <aura:handler name="ProductSearchEvent" event="c:ProductSearchEvent" action="{!c.onProductSelected}"/>
    
    <div class="slds">
        
        <aura:if isTrue="{!v.showProgressBar}">
            <c:ProgressBarLightningMobile />
            
            <aura:set attribute="else">
                
                <div id="pageLabel">
                    {!if(v.optyId == null, 'Add potential opportunity', 'Edit potential opportunity')}
                </div>
                
                <div id="wholePage">
                    <ui:inputText aura:id="name" label="Name" class="marginBottom1em" value="{!v.opty.Name}"/>
                    <span aura:id="nameError" class="toggle red">Name is required</span>
                    
                    <ui:inputDate aura:id="closeDate" label="Close date" class="marginBottom1em" value="{!v.opty.Close_Date__c}"/>
                    <span aura:id="closeDateError" class="toggle red">Close date is required for conversion</span>
                    
                    <c:ClientPlanProductSearch timestamp="{!v.timestamp}" value="{!v.opty.Product_Level_3__r.Name}" />
                    
                    <ui:inputSelect aura:id="stage" label="Stage" class="dynamic marginBottom1em" change="{!c.onStageChanged}">
                        <aura:iteration items="{!v.stageOptions}" var="o">
                            <ui:inputSelectOption text="{!o}" label="{!o}" value="{!if(v.opty.Stage__c == o, true, false)}"/>
                        </aura:iteration>
                    </ui:inputSelect>
                    
                    <ui:inputText aura:id="probability" label="Probability" class="marginBottom1em" disabled="true" 
                                  value="{!v.opty.Probability__c}"/>
                    
                    <ui:inputSelect aura:id="type" label="Type" class="dynamic">
                        <aura:iteration items="{!v.typeOptions}" var="o">
                            <ui:inputSelectOption text="{!o}" label="{!o}" value="{!if(v.opty.Type__c == o, true, false)}"/>
                        </aura:iteration>
                    </ui:inputSelect>
                    
                    <div id="buttonsWrapper">
                        <button class="slds-button slds-button--brand marginRight1" onclick="{!c.onBeforeConvertPotOpty}" 
                                disabled="{!if(v.opty.Stage__c == 'Potential Opportunity Convert', '', 'disabled')}">Convert</button>
                        <button class="slds-button slds-button--neutral marginRight1" onclick="{!c.moveBack}">Cancel</button>
                        <button class="slds-button slds-button--brand" onclick="{!c.onBeforeAddPotOpty}">Save</button>
                    </div>
                </div>
                
            </aura:set>
        </aura:if>
    </div>
    
</aura:component>